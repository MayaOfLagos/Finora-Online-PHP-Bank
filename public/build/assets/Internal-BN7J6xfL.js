import{k as le,f as ne,C as ie,j as h,y as oe,c as p,d as n,u as s,p as ue,w as c,a as e,s as E,i as C,h as P,b as y,o as d,F as R,r as J,n as w,t as o,e as X,q as F}from"./app-BTmqTPFI.js";import{a as x}from"./index-B9kb_fgF.js";import{s as $}from"./index-ukHySufX.js";import{s as de}from"./index-p4pRHJ1w.js";import{s as ce}from"./index-DZ1BMyBN.js";import{s as me}from"./index-B9hE6BuF.js";import{s as K}from"./index-lQnEeHiM.js";import{s as O}from"./index-DkbI8jXY.js";import{s as W}from"./index-DL4BWZ5E.js";import{_ as pe}from"./DashboardLayout-DLpur63g.js";import{_ as fe}from"./PinInput-WOdZwQR0.js";import{O as ve}from"./OtpInput-BGLJYEYk.js";import{u as ye}from"./useCurrency-0zMdEeak.js";/* empty css            */import"./index-w1hA638j.js";import"./index-BpROmj6E.js";import"./index-DKy2-VhW.js";import"./index-DIIYjyrO.js";import"./AppLogo-BZy6E-qR.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-v9Vk3IOX.js";const xe={class:"max-w-2xl mx-auto"},ge={class:"max-w-2xl mx-auto"},be={class:"mb-4"},_e={class:"space-y-6"},ke={class:"space-y-3"},he=["onClick"],we={class:"flex items-center justify-between"},Se={class:"flex items-center gap-3"},Ce={class:"font-medium text-gray-900 dark:text-white"},Te={class:"text-sm text-gray-500 dark:text-gray-400"},Ve={class:"text-right"},je={key:0,class:"mt-2 text-red-500 block"},Ae={key:0},Pe={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Ie=["onClick"],Ne={class:"flex items-center gap-3"},Be={key:0,class:"pi pi-star-fill text-yellow-400"},Fe={class:"flex-1 min-w-0"},$e={class:"font-medium text-gray-900 truncate dark:text-white"},Oe={class:"text-xs text-gray-500 dark:text-gray-400"},Ue={key:0,class:"pi pi-check-circle text-indigo-600"},De={class:"flex gap-2"},Ee={key:0,class:"text-red-500"},Re={class:"flex items-center gap-3"},Xe={class:"font-semibold"},Me={class:"text-sm opacity-80"},Le={class:"flex justify-between mt-1 text-xs text-gray-500"},qe={key:0},Ye={key:0,class:"text-red-500"},ze={class:"flex justify-end gap-3 pt-4"},Qe={class:"mb-4"},Ge={class:"space-y-6"},He={class:"p-4 space-y-4 rounded-lg bg-gray-50 dark:bg-gray-800"},Je={class:"flex justify-between"},Ke={class:"font-medium text-gray-900 dark:text-white"},We={class:"flex justify-between"},Ze={class:"font-medium text-gray-900 dark:text-white"},et={class:"flex justify-between"},tt={class:"text-xl font-bold text-gray-900 dark:text-white"},st={key:0,class:"flex justify-between"},rt={class:"font-medium text-gray-900 dark:text-white"},at={class:"flex justify-between gap-3 pt-4"},lt={class:"mb-4"},nt={class:"py-8 text-center"},it={class:"mb-4"},ot={class:"py-8 text-center"},ut={class:"p-4 mt-6 text-left rounded-lg bg-gray-50 dark:bg-gray-800"},dt={class:"space-y-3"},ct={class:"flex justify-between"},mt={class:"font-mono text-gray-900 dark:text-white"},pt={class:"flex justify-between"},ft={class:"font-bold text-gray-900 dark:text-white"},vt={class:"flex justify-between"},yt={class:"text-gray-900 dark:text-white"},xt={class:"flex justify-center gap-3 mt-6"},gt={class:"space-y-4"},bt={class:"space-y-4"},Mt={__name:"Internal",props:{accounts:{type:Array,default:()=>[]},beneficiaries:{type:Array,default:()=>[]},transferLimits:{type:Object,default:()=>({daily:5e4,perTransaction:1e4})},preselectedAccountId:{type:[String,Number],default:null},preselectedBeneficiary:{type:Object,default:null},verificationConfig:{type:Object,default:()=>({requiresOtp:!0})}},setup(Z){const f=Z,v=le(),{formatCurrency:V}=ye(),r=ne({from_account_id:f.preselectedAccountId||null,to_account_number:"",amount:null,description:"",pin:"",otp:""}),u=h(0),j=h(!1),T=h(!1),U=h(!1),S=h(!1),b=h(null),g=h(!1),I=h(!1),N=h(null),_=h(null),B=[{label:"Details"},{label:"Confirm"},{label:"Verify"},{label:"Complete"}],k=X(()=>f.accounts.find(l=>l.id===r.from_account_id)),ee=X(()=>{if(!r.amount||!k.value)return!1;const l=r.amount*100;return l>0&&l<=k.value.balance&&r.amount<=f.transferLimits.perTransaction}),M=X(()=>u.value===0?r.from_account_id&&S.value&&ee.value:!0),te=async()=>{if(!(!r.to_account_number||r.to_account_number.length<10)){U.value=!0,S.value=!1,b.value=null;try{const t=await(await fetch(route("api.accounts.verify",{accountNumber:r.to_account_number}))).json();if(t.success){const i=f.accounts.find(m=>m.id===r.from_account_id);if(i&&i.account_number===r.to_account_number){v.add({severity:"error",summary:"Invalid Recipient",detail:"You cannot transfer to your own account",life:3e3});return}S.value=!0,b.value=t.recipient}else v.add({severity:"error",summary:"Recipient Not Found",detail:"No account found with this account number",life:3e3})}catch{v.add({severity:"error",summary:"Verification Failed",detail:"Unable to verify recipient. Please try again.",life:3e3})}finally{U.value=!1}}},L=l=>{_.value=l,r.to_account_number=l.account_number,S.value=!0,b.value={name:l.nickname||l.beneficiary_name,account_type:"Savings"},v.add({severity:"success",summary:"Beneficiary Selected",detail:`Transferring to ${l.nickname||l.beneficiary_name}`,life:2e3})};ie(()=>r.to_account_number,l=>{_.value&&_.value.account_number!==l&&(_.value=null),_.value||(S.value=!1,b.value=null)});const q=()=>{u.value===0&&M.value?u.value=1:u.value===1&&(j.value=!0)},se=()=>{u.value>0&&u.value--},Y=()=>{if(r.pin.length!==6){v.add({severity:"error",summary:"Invalid PIN",detail:"Please enter your 6-digit transaction PIN",life:3e3});return}j.value=!1,g.value=!0,f.verificationConfig.requiresOtp?F.post("/transfers/internal/request-otp",{pin:r.pin,from_account_id:r.from_account_id,amount:Math.round((r.amount||0)*100)},{preserveScroll:!0,onSuccess:l=>{var i,m;u.value=2,T.value=!0;const t=((m=(i=l==null?void 0:l.props)==null?void 0:i.flash)==null?void 0:m.success)||"A verification code has been sent to your email";v.add({severity:"success",summary:"OTP Sent",detail:t,life:5e3})},onError:l=>{v.add({severity:"error",summary:"Verification Failed",detail:l.pin||"Invalid PIN. Please try again.",life:3e3})},onFinish:()=>{g.value=!1}}):F.post(route("transfers.internal.process"),{from_account_id:r.from_account_id,to_account_number:r.to_account_number,amount:Math.round((r.amount||0)*100),description:r.description,pin:r.pin,otp:"skip_otp"},{preserveScroll:!0,onSuccess:l=>{I.value=!0,N.value=l.props.transfer,u.value=3,v.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:l=>{v.add({severity:"error",summary:"Transfer Failed",detail:l.pin||l.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{g.value=!1}})},z=()=>{if(r.otp.length!==6){v.add({severity:"error",summary:"Invalid OTP",detail:"Please enter the 6-digit verification code",life:3e3});return}g.value=!0,F.post(route("transfers.internal.process"),{from_account_id:r.from_account_id,to_account_number:r.to_account_number,amount:Math.round((r.amount||0)*100),description:r.description,pin:r.pin,otp:r.otp},{preserveScroll:!0,onSuccess:l=>{T.value=!1,I.value=!0,N.value=l.props.transfer,u.value=3,v.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:l=>{v.add({severity:"error",summary:"Transfer Failed",detail:l.otp||l.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{g.value=!1}})},re=()=>{F.post(route("transfers.internal.request-otp"),{pin:r.pin,from_account_id:r.from_account_id,amount:r.amount},{preserveScroll:!0,onSuccess:l=>{var i,m;const t=((m=(i=l==null?void 0:l.props)==null?void 0:i.flash)==null?void 0:m.success)||"A new verification code has been sent";v.add({severity:"success",summary:"OTP Resent",detail:t,life:3e3})}})},ae=()=>{r.reset(),u.value=0,I.value=!1,N.value=null,S.value=!1,b.value=null,_.value=null};return oe(()=>{f.preselectedBeneficiary&&L(f.preselectedBeneficiary)}),(l,t)=>(d(),p(R,null,[n(s(ue),{title:"Internal Transfer"}),n(pe,{title:"Internal Transfer"},{default:c(()=>[e("div",xe,[n(s(E),{href:"/transfers",class:"inline-flex items-center gap-2 mb-6 text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:c(()=>[...t[10]||(t[10]=[e("i",{class:"pi pi-arrow-left"},null,-1),C(" Back to Transfers ",-1)])]),_:1}),t[11]||(t[11]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Internal Transfer "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Transfer funds instantly to another Finora Bank user ")],-1))]),e("div",ge,[u.value===0?(d(),P(s($),{key:0},{title:c(()=>[e("div",be,[n(s(O),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])]),t[12]||(t[12]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-file-edit text-primary-500"}),C(" Transfer Details ")],-1))]),content:c(()=>{var i,m;return[e("div",_e,[e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-wallet text-primary-600"}),C(" Select Source Account "),e("span",{class:"text-red-500"},"*")])],-1)),e("div",ke,[(d(!0),p(R,null,J(f.accounts.filter(a=>a.is_active),a=>{var A;return d(),p("div",{key:a.id,onClick:D=>s(r).from_account_id=a.id,class:w(["p-4 transition-all duration-300 ease-in-out border-2 rounded-lg cursor-pointer",[s(r).from_account_id===a.id?"border-green-500 bg-green-50 dark:bg-green-900/20 shadow-md shadow-green-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",we,[e("div",Se,[e("div",{class:w(["flex items-center justify-center w-10 h-10 transition-all duration-300 rounded-full",[s(r).from_account_id===a.id?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-500"]])},[e("i",{class:w(["pi transition-all duration-300",[s(r).from_account_id===a.id?"pi-check":"pi-wallet"]])},null,2)],2),e("div",null,[e("p",Ce,o(((A=a.account_type)==null?void 0:A.name)||"Account"),1),e("p",Te," ****"+o(a.account_number.slice(-4))+" • "+o(a.currency||"USD"),1)])]),e("div",Ve,[e("p",{class:w(["text-lg font-bold",[s(r).from_account_id===a.id?"text-green-600":"text-gray-900 dark:text-white"]])},o(s(V)(a.balance,a.currency)),3),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500"},"Available",-1))])])],10,he)}),128))]),s(r).errors.from_account_id?(d(),p("small",je,o(s(r).errors.from_account_id),1)):y("",!0)]),f.beneficiaries&&f.beneficiaries.length>0?(d(),p("div",Ae,[t[15]||(t[15]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-users text-primary-600"}),C(" Quick Select from Saved Beneficiaries ")])],-1)),e("div",Pe,[(d(!0),p(R,null,J(f.beneficiaries,a=>{var A,D,Q,G,H;return d(),p("div",{key:a.uuid,onClick:_t=>L(a),class:w(["p-3 transition-all border-2 rounded-lg cursor-pointer hover:shadow-md",[((A=_.value)==null?void 0:A.uuid)===a.uuid?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-gray-200 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600"]])},[e("div",Ne,[e("div",{class:w(["flex items-center justify-center w-10 h-10 rounded-full",[((D=_.value)==null?void 0:D.uuid)===a.uuid?"bg-indigo-500 text-white":"bg-gray-100 dark:bg-gray-700"]])},[a.is_favorite?(d(),p("i",Be)):(d(),p("i",{key:1,class:w(["pi pi-user",((Q=_.value)==null?void 0:Q.uuid)===a.uuid?"text-white":"text-gray-500"])},null,2))],2),e("div",Fe,[e("p",$e,o(a.nickname||a.beneficiary_name),1),e("p",Oe," ****"+o((G=a.account_number)==null?void 0:G.slice(-4))+" • "+o(a.currency),1)]),((H=_.value)==null?void 0:H.uuid)===a.uuid?(d(),p("i",Ue)):y("",!0)])],10,Ie)}),128))]),t[16]||(t[16]=e("div",{class:"flex items-center my-4"},[e("div",{class:"flex-1 border-t border-gray-200 dark:border-gray-700"}),e("span",{class:"px-4 text-sm text-gray-500 dark:text-gray-400"},"or enter manually"),e("div",{class:"flex-1 border-t border-gray-200 dark:border-gray-700"})],-1))])):y("",!0),e("div",null,[t[17]||(t[17]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[C(" Recipient Account Number "),e("span",{class:"text-red-500"},"*")],-1)),e("div",De,[n(s(ce),{modelValue:s(r).to_account_number,"onUpdate:modelValue":t[0]||(t[0]=a=>s(r).to_account_number=a),placeholder:"Enter account number",class:w(["flex-1",{"p-invalid":s(r).errors.to_account_number}])},null,8,["modelValue","class"]),n(s(x),{label:"Verify",icon:"pi pi-check",loading:U.value,disabled:!s(r).to_account_number||s(r).to_account_number.length<10,onClick:te},null,8,["loading","disabled"])]),s(r).errors.to_account_number?(d(),p("small",Ee,o(s(r).errors.to_account_number),1)):y("",!0)]),S.value&&b.value?(d(),P(s(W),{key:1,severity:"success",closable:!1},{default:c(()=>[e("div",Re,[t[18]||(t[18]=e("i",{class:"text-xl pi pi-user"},null,-1)),e("div",null,[e("p",Xe,o(b.value.name),1),e("p",Me,o(b.value.account_type)+" Account",1)])])]),_:1})):y("",!0),e("div",null,[t[19]||(t[19]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[C(" Amount "),e("span",{class:"text-red-500"},"*")],-1)),n(s(de),{modelValue:s(r).amount,"onUpdate:modelValue":t[1]||(t[1]=a=>s(r).amount=a),mode:"currency",currency:((i=k.value)==null?void 0:i.currency)||"USD",locale:"en-US",placeholder:"0.00",class:w(["w-full",{"p-invalid":s(r).errors.amount}]),min:1,max:f.transferLimits.perTransaction},null,8,["modelValue","currency","class","max"]),e("div",Le,[k.value?(d(),p("span",qe," Available: "+o(s(V)(k.value.balance,k.value.currency)),1)):y("",!0),e("span",null," Limit: "+o(s(V)(f.transferLimits.perTransaction*100,((m=k.value)==null?void 0:m.currency)||"USD"))+"/transaction ",1)]),s(r).errors.amount?(d(),p("small",Ye,o(s(r).errors.amount),1)):y("",!0)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"}," Description (Optional) ",-1)),n(s(me),{modelValue:s(r).description,"onUpdate:modelValue":t[2]||(t[2]=a=>s(r).description=a),rows:"3",placeholder:"Add a note for this transfer",class:"w-full"},null,8,["modelValue"])]),e("div",ze,[n(s(E),{href:"/transfers"},{default:c(()=>[n(s(x),{label:"Cancel",outlined:""})]),_:1}),n(s(x),{label:"Continue",icon:"pi pi-arrow-right",iconPos:"right",disabled:!M.value,onClick:q},null,8,["disabled"])])])]}),_:1})):y("",!0),u.value===1?(d(),P(s($),{key:1},{title:c(()=>[e("div",Qe,[n(s(O),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])]),t[21]||(t[21]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-eye text-primary-500"}),C(" Confirm Transfer ")],-1))]),content:c(()=>{var i,m,a;return[e("div",Ge,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Confirm Transfer Details ",-1)),e("div",He,[e("div",Je,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"From",-1)),e("span",Ke," ****"+o((i=k.value)==null?void 0:i.account_number.slice(-4)),1)]),e("div",We,[t[23]||(t[23]=e("span",{class:"text-gray-500"},"To",-1)),e("span",Ze,o((m=b.value)==null?void 0:m.name)+" (****"+o(s(r).to_account_number.slice(-4))+") ",1)]),e("div",et,[t[24]||(t[24]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",tt,o(s(V)(s(r).amount*100,((a=k.value)==null?void 0:a.currency)||"USD")),1)]),s(r).description?(d(),p("div",st,[t[25]||(t[25]=e("span",{class:"text-gray-500"},"Description",-1)),e("span",rt,o(s(r).description),1)])):y("",!0),t[26]||(t[26]=e("div",{class:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700"},[e("span",{class:"text-gray-500"},"Fee"),e("span",{class:"font-medium text-green-600"},"Free")],-1))]),n(s(W),{severity:"info",closable:!1},{default:c(()=>[...t[27]||(t[27]=[e("p",{class:"text-sm"}," By proceeding, you authorize this transfer. This action cannot be undone. ",-1)])]),_:1}),e("div",at,[n(s(x),{label:"Back",icon:"pi pi-arrow-left",outlined:"",onClick:se}),n(s(x),{label:"Confirm & Enter PIN",icon:"pi pi-lock",onClick:q})])])]}),_:1})):y("",!0),u.value===2?(d(),P(s($),{key:2},{title:c(()=>[e("div",lt,[n(s(O),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])])]),content:c(()=>[e("div",nt,[t[29]||(t[29]=e("i",{class:"mb-4 text-5xl text-indigo-600 pi pi-shield"},null,-1)),t[30]||(t[30]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Verification in Progress ",-1)),t[31]||(t[31]=e("p",{class:"mt-2 text-gray-500"}," Please complete the verification to proceed with your transfer. ",-1)),n(s(x),{label:"Enter Verification Code",icon:"pi pi-key",class:"mt-4",onClick:t[3]||(t[3]=i=>T.value=!0)})])]),_:1})):y("",!0),u.value===3&&I.value?(d(),P(s($),{key:3},{title:c(()=>[e("div",it,[n(s(O),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])])]),content:c(()=>{var i,m,a;return[e("div",ot,[t[35]||(t[35]=e("div",{class:"flex items-center justify-center w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30"},[e("i",{class:"text-4xl text-green-600 pi pi-check dark:text-green-400"})],-1)),t[36]||(t[36]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"}," Transfer Successful! ",-1)),t[37]||(t[37]=e("p",{class:"mt-2 text-gray-500"}," Your transfer has been completed successfully. ",-1)),e("div",ut,[e("div",dt,[e("div",ct,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Reference",-1)),e("span",mt,o(((i=N.value)==null?void 0:i.reference)||"TXN-XXXXXXXX"),1)]),e("div",pt,[t[33]||(t[33]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",ft,o(s(V)(s(r).amount*100,((m=k.value)==null?void 0:m.currency)||"USD")),1)]),e("div",vt,[t[34]||(t[34]=e("span",{class:"text-gray-500"},"Recipient",-1)),e("span",yt,o((a=b.value)==null?void 0:a.name),1)])])]),e("div",xt,[n(s(x),{label:"New Transfer",icon:"pi pi-plus",outlined:"",onClick:ae}),n(s(E),{href:"/accounts"},{default:c(()=>[n(s(x),{label:"View Accounts",icon:"pi pi-wallet"})]),_:1})])])]}),_:1})):y("",!0)]),n(s(K),{visible:j.value,"onUpdate:visible":t[6]||(t[6]=i=>j.value=i),modal:"",header:"Enter Transaction PIN",style:{width:"480px"},closable:!g.value},{footer:c(()=>[n(s(x),{label:"Cancel",text:"",onClick:t[5]||(t[5]=i=>j.value=!1),disabled:g.value},null,8,["disabled"]),n(s(x),{label:"Verify",icon:"pi pi-check",loading:g.value,onClick:Y},null,8,["loading"])]),default:c(()=>[e("div",gt,[t[38]||(t[38]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter your 6-digit transaction PIN to continue. ",-1)),n(fe,{modelValue:s(r).pin,"onUpdate:modelValue":t[4]||(t[4]=i=>s(r).pin=i),length:6,masked:"",onComplete:Y},null,8,["modelValue"])])]),_:1},8,["visible","closable"]),n(s(K),{visible:T.value,"onUpdate:visible":t[9]||(t[9]=i=>T.value=i),modal:"",header:"Email Verification",style:{width:"400px"},closable:!g.value},{footer:c(()=>[n(s(x),{label:"Cancel",text:"",onClick:t[8]||(t[8]=i=>{T.value=!1,u.value=1}),disabled:g.value},null,8,["disabled"]),n(s(x),{label:"Verify & Transfer",icon:"pi pi-send",loading:g.value,onClick:z},null,8,["loading"])]),default:c(()=>[e("div",bt,[t[39]||(t[39]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter the 6-digit code sent to your registered email address. ",-1)),n(ve,{modelValue:s(r).otp,"onUpdate:modelValue":t[7]||(t[7]=i=>s(r).otp=i),length:6,onComplete:z,onResend:re},null,8,["modelValue"])])]),_:1},8,["visible","closable"])]),_:1})],64))}};export{Mt as default};
