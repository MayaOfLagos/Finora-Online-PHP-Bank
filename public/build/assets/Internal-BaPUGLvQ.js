import{k as Q,f as W,G as Z,j as b,c as k,d as n,u as s,p as ee,w as d,a as e,s as $,i as S,g as A,b as v,o as c,F as M,r as te,n as C,t as u,e as D,q as N}from"./app-BqnbQAXf.js";import{a as p}from"./index-Bfq2pgeT.js";import{s as F}from"./index-DL0SVfAl.js";import{s as se}from"./index-CabryDxu.js";import{s as ae}from"./index-BNeyFdl0.js";import{s as re}from"./index-CCePTBbk.js";import{a as L,_ as ne}from"./DashboardLayout-C0v_04ly.js";import{s as U}from"./index-D35pE5r9.js";import{s as q}from"./index-Bzfsir9a.js";import{_ as le}from"./PinInput-DLGA_q1M.js";import{O as oe}from"./OtpInput-zsMNV0kQ.js";import{u as ie}from"./useCurrency-0zMdEeak.js";/* empty css            */import"./index-D3BIVwuM.js";import"./index-Dy2c4_10.js";import"./index-hFFyenF8.js";import"./index-BjC23aV3.js";import"./AppLogo-1L2GQ82H.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={class:"max-w-2xl mx-auto"},de={class:"max-w-2xl mx-auto"},ce={class:"mb-4"},me={class:"space-y-6"},pe={class:"space-y-3"},fe=["onClick"],ve={class:"flex items-center justify-between"},ye={class:"flex items-center gap-3"},xe={class:"font-medium text-gray-900 dark:text-white"},be={class:"text-sm text-gray-500 dark:text-gray-400"},ge={class:"text-right"},_e={key:0,class:"mt-2 text-red-500 block"},ke={class:"flex gap-2"},he={key:0,class:"text-red-500"},we={class:"flex items-center gap-3"},Se={class:"font-semibold"},Ce={class:"text-sm opacity-80"},Ve={class:"flex justify-between mt-1 text-xs text-gray-500"},Te={key:0},Ae={key:0,class:"text-red-500"},Pe={class:"flex justify-end gap-3 pt-4"},je={class:"mb-4"},Ie={class:"space-y-6"},Ne={class:"p-4 space-y-4 rounded-lg bg-gray-50 dark:bg-gray-800"},Fe={class:"flex justify-between"},Ue={class:"font-medium text-gray-900 dark:text-white"},Oe={class:"flex justify-between"},$e={class:"font-medium text-gray-900 dark:text-white"},De={class:"flex justify-between"},Ee={class:"text-xl font-bold text-gray-900 dark:text-white"},Re={key:0,class:"flex justify-between"},Xe={class:"font-medium text-gray-900 dark:text-white"},Be={class:"flex justify-between gap-3 pt-4"},Me={class:"mb-4"},Le={class:"py-8 text-center"},qe={class:"mb-4"},Ye={class:"py-8 text-center"},ze={class:"p-4 mt-6 text-left rounded-lg bg-gray-50 dark:bg-gray-800"},Ge={class:"space-y-3"},He={class:"flex justify-between"},Je={class:"font-mono text-gray-900 dark:text-white"},Ke={class:"flex justify-between"},Qe={class:"font-bold text-gray-900 dark:text-white"},We={class:"flex justify-between"},Ze={class:"text-gray-900 dark:text-white"},et={class:"flex justify-center gap-3 mt-6"},tt={class:"space-y-4"},st={class:"space-y-4"},wt={__name:"Internal",props:{accounts:{type:Array,default:()=>[]},beneficiaries:{type:Array,default:()=>[]},transferLimits:{type:Object,default:()=>({daily:5e4,perTransaction:1e4})},preselectedAccountId:{type:[String,Number],default:null},verificationConfig:{type:Object,default:()=>({requiresOtp:!0})}},setup(Y){const g=Y,m=Q(),{formatCurrency:V}=ie(),a=W({from_account_id:g.preselectedAccountId||null,to_account_number:"",amount:null,description:"",pin:"",otp:""}),i=b(0),T=b(!1),h=b(!1),O=b(!1),w=b(!1),y=b(null),f=b(!1),P=b(!1),j=b(null),I=[{label:"Details"},{label:"Confirm"},{label:"Verify"},{label:"Complete"}],x=D(()=>g.accounts.find(o=>o.id===a.from_account_id)),z=D(()=>{if(!a.amount||!x.value)return!1;const o=a.amount*100;return o>0&&o<=x.value.balance&&a.amount<=g.transferLimits.perTransaction}),E=D(()=>i.value===0?a.from_account_id&&w.value&&z.value:!0),G=async()=>{if(!(!a.to_account_number||a.to_account_number.length<10)){O.value=!0,w.value=!1,y.value=null;try{const t=await(await fetch(route("api.accounts.verify",{accountNumber:a.to_account_number}))).json();if(t.success){const l=g.accounts.find(r=>r.id===a.from_account_id);if(l&&l.account_number===a.to_account_number){m.add({severity:"error",summary:"Invalid Recipient",detail:"You cannot transfer to your own account",life:3e3});return}w.value=!0,y.value=t.recipient}else m.add({severity:"error",summary:"Recipient Not Found",detail:"No account found with this account number",life:3e3})}catch{m.add({severity:"error",summary:"Verification Failed",detail:"Unable to verify recipient. Please try again.",life:3e3})}finally{O.value=!1}}};Z(()=>a.to_account_number,()=>{w.value=!1,y.value=null});const R=()=>{i.value===0&&E.value?i.value=1:i.value===1&&(T.value=!0)},H=()=>{i.value>0&&i.value--},X=()=>{if(a.pin.length!==6){m.add({severity:"error",summary:"Invalid PIN",detail:"Please enter your 6-digit transaction PIN",life:3e3});return}T.value=!1,f.value=!0,g.verificationConfig.requiresOtp?N.post("/transfers/internal/request-otp",{pin:a.pin,from_account_id:a.from_account_id,amount:Math.round((a.amount||0)*100)},{preserveScroll:!0,onSuccess:o=>{var l,r;i.value=2,h.value=!0;const t=((r=(l=o==null?void 0:o.props)==null?void 0:l.flash)==null?void 0:r.success)||"A verification code has been sent to your email";m.add({severity:"success",summary:"OTP Sent",detail:t,life:5e3})},onError:o=>{m.add({severity:"error",summary:"Verification Failed",detail:o.pin||"Invalid PIN. Please try again.",life:3e3})},onFinish:()=>{f.value=!1}}):N.post(route("transfers.internal.process"),{from_account_id:a.from_account_id,to_account_number:a.to_account_number,amount:Math.round((a.amount||0)*100),description:a.description,pin:a.pin,otp:"skip_otp"},{preserveScroll:!0,onSuccess:o=>{P.value=!0,j.value=o.props.transfer,i.value=3,m.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:o=>{m.add({severity:"error",summary:"Transfer Failed",detail:o.pin||o.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{f.value=!1}})},B=()=>{if(a.otp.length!==6){m.add({severity:"error",summary:"Invalid OTP",detail:"Please enter the 6-digit verification code",life:3e3});return}f.value=!0,N.post(route("transfers.internal.process"),{from_account_id:a.from_account_id,to_account_number:a.to_account_number,amount:Math.round((a.amount||0)*100),description:a.description,pin:a.pin,otp:a.otp},{preserveScroll:!0,onSuccess:o=>{h.value=!1,P.value=!0,j.value=o.props.transfer,i.value=3,m.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:o=>{m.add({severity:"error",summary:"Transfer Failed",detail:o.otp||o.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{f.value=!1}})},J=()=>{N.post(route("transfers.internal.request-otp"),{pin:a.pin,from_account_id:a.from_account_id,amount:a.amount},{preserveScroll:!0,onSuccess:o=>{var l,r;const t=((r=(l=o==null?void 0:o.props)==null?void 0:l.flash)==null?void 0:r.success)||"A new verification code has been sent";m.add({severity:"success",summary:"OTP Resent",detail:t,life:3e3})}})},K=()=>{a.reset(),i.value=0,P.value=!1,j.value=null,w.value=!1,y.value=null};return(o,t)=>(c(),k(M,null,[n(s(ee),{title:"Internal Transfer"}),n(ne,{title:"Internal Transfer"},{default:d(()=>[e("div",ue,[n(s($),{href:"/transfers",class:"inline-flex items-center gap-2 mb-6 text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:d(()=>[...t[10]||(t[10]=[e("i",{class:"pi pi-arrow-left"},null,-1),S(" Back to Transfers ",-1)])]),_:1}),t[11]||(t[11]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Internal Transfer "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Transfer funds instantly to another Finora Bank user ")],-1))]),e("div",de,[i.value===0?(c(),A(s(F),{key:0},{title:d(()=>[e("div",ce,[n(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])]),t[12]||(t[12]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-file-edit text-primary-500"}),S(" Transfer Details ")],-1))]),content:d(()=>{var l;return[e("div",me,[e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-wallet text-primary-600"}),S(" Select Source Account "),e("span",{class:"text-red-500"},"*")])],-1)),e("div",pe,[(c(!0),k(M,null,te(g.accounts.filter(r=>r.is_active),r=>{var _;return c(),k("div",{key:r.id,onClick:at=>s(a).from_account_id=r.id,class:C(["p-4 transition-all duration-300 ease-in-out border-2 rounded-lg cursor-pointer",[s(a).from_account_id===r.id?"border-green-500 bg-green-50 dark:bg-green-900/20 shadow-md shadow-green-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",ve,[e("div",ye,[e("div",{class:C(["flex items-center justify-center w-10 h-10 transition-all duration-300 rounded-full",[s(a).from_account_id===r.id?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-500"]])},[e("i",{class:C(["pi transition-all duration-300",[s(a).from_account_id===r.id?"pi-check":"pi-wallet"]])},null,2)],2),e("div",null,[e("p",xe,u(((_=r.account_type)==null?void 0:_.name)||"Account"),1),e("p",be," ****"+u(r.account_number.slice(-4))+" â€¢ "+u(r.currency||"USD"),1)])]),e("div",ge,[e("p",{class:C(["text-lg font-bold",[s(a).from_account_id===r.id?"text-green-600":"text-gray-900 dark:text-white"]])},u(s(V)(r.balance,r.currency)),3),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500"},"Available",-1))])])],10,fe)}),128))]),s(a).errors.from_account_id?(c(),k("small",_e,u(s(a).errors.from_account_id),1)):v("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[S(" Recipient Account Number "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ke,[n(s(ae),{modelValue:s(a).to_account_number,"onUpdate:modelValue":t[0]||(t[0]=r=>s(a).to_account_number=r),placeholder:"Enter account number",class:C(["flex-1",{"p-invalid":s(a).errors.to_account_number}])},null,8,["modelValue","class"]),n(s(p),{label:"Verify",icon:"pi pi-check",loading:O.value,disabled:!s(a).to_account_number||s(a).to_account_number.length<10,onClick:G},null,8,["loading","disabled"])]),s(a).errors.to_account_number?(c(),k("small",he,u(s(a).errors.to_account_number),1)):v("",!0)]),w.value&&y.value?(c(),A(s(q),{key:0,severity:"success",closable:!1},{default:d(()=>[e("div",we,[t[16]||(t[16]=e("i",{class:"text-xl pi pi-user"},null,-1)),e("div",null,[e("p",Se,u(y.value.name),1),e("p",Ce,u(y.value.account_type)+" Account",1)])])]),_:1})):v("",!0),e("div",null,[t[17]||(t[17]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[S(" Amount "),e("span",{class:"text-red-500"},"*")],-1)),n(s(se),{modelValue:s(a).amount,"onUpdate:modelValue":t[1]||(t[1]=r=>s(a).amount=r),mode:"currency",currency:((l=x.value)==null?void 0:l.currency)||"USD",locale:"en-US",placeholder:"0.00",class:C(["w-full",{"p-invalid":s(a).errors.amount}]),min:1,max:g.transferLimits.perTransaction},null,8,["modelValue","currency","class","max"]),e("div",Ve,[x.value?(c(),k("span",Te," Available: "+u(s(V)(x.value.balance,x.value.currency)),1)):v("",!0),e("span",null," Limit: "+u(s(V)(g.transferLimits.perTransaction*100,"USD"))+"/transaction ",1)]),s(a).errors.amount?(c(),k("small",Ae,u(s(a).errors.amount),1)):v("",!0)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"}," Description (Optional) ",-1)),n(s(re),{modelValue:s(a).description,"onUpdate:modelValue":t[2]||(t[2]=r=>s(a).description=r),rows:"3",placeholder:"Add a note for this transfer",class:"w-full"},null,8,["modelValue"])]),e("div",Pe,[n(s($),{href:"/transfers"},{default:d(()=>[n(s(p),{label:"Cancel",outlined:""})]),_:1}),n(s(p),{label:"Continue",icon:"pi pi-arrow-right",iconPos:"right",disabled:!E.value,onClick:R},null,8,["disabled"])])])]}),_:1})):v("",!0),i.value===1?(c(),A(s(F),{key:1},{title:d(()=>[e("div",je,[n(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])]),t[19]||(t[19]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-eye text-primary-500"}),S(" Confirm Transfer ")],-1))]),content:d(()=>{var l,r,_;return[e("div",Ie,[t[26]||(t[26]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Confirm Transfer Details ",-1)),e("div",Ne,[e("div",Fe,[t[20]||(t[20]=e("span",{class:"text-gray-500"},"From",-1)),e("span",Ue," ****"+u((l=x.value)==null?void 0:l.account_number.slice(-4)),1)]),e("div",Oe,[t[21]||(t[21]=e("span",{class:"text-gray-500"},"To",-1)),e("span",$e,u((r=y.value)==null?void 0:r.name)+" (****"+u(s(a).to_account_number.slice(-4))+") ",1)]),e("div",De,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",Ee,u(s(V)(s(a).amount*100,((_=x.value)==null?void 0:_.currency)||"USD")),1)]),s(a).description?(c(),k("div",Re,[t[23]||(t[23]=e("span",{class:"text-gray-500"},"Description",-1)),e("span",Xe,u(s(a).description),1)])):v("",!0),t[24]||(t[24]=e("div",{class:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700"},[e("span",{class:"text-gray-500"},"Fee"),e("span",{class:"font-medium text-green-600"},"Free")],-1))]),n(s(q),{severity:"info",closable:!1},{default:d(()=>[...t[25]||(t[25]=[e("p",{class:"text-sm"}," By proceeding, you authorize this transfer. This action cannot be undone. ",-1)])]),_:1}),e("div",Be,[n(s(p),{label:"Back",icon:"pi pi-arrow-left",outlined:"",onClick:H}),n(s(p),{label:"Confirm & Enter PIN",icon:"pi pi-lock",onClick:R})])])]}),_:1})):v("",!0),i.value===2?(c(),A(s(F),{key:2},{title:d(()=>[e("div",Me,[n(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>[e("div",Le,[t[27]||(t[27]=e("i",{class:"mb-4 text-5xl text-indigo-600 pi pi-shield"},null,-1)),t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Verification in Progress ",-1)),t[29]||(t[29]=e("p",{class:"mt-2 text-gray-500"}," Please complete the verification to proceed with your transfer. ",-1)),n(s(p),{label:"Enter Verification Code",icon:"pi pi-key",class:"mt-4",onClick:t[3]||(t[3]=l=>h.value=!0)})])]),_:1})):v("",!0),i.value===3&&P.value?(c(),A(s(F),{key:3},{title:d(()=>[e("div",qe,[n(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>{var l,r,_;return[e("div",Ye,[t[33]||(t[33]=e("div",{class:"flex items-center justify-center w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30"},[e("i",{class:"text-4xl text-green-600 pi pi-check dark:text-green-400"})],-1)),t[34]||(t[34]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"}," Transfer Successful! ",-1)),t[35]||(t[35]=e("p",{class:"mt-2 text-gray-500"}," Your transfer has been completed successfully. ",-1)),e("div",ze,[e("div",Ge,[e("div",He,[t[30]||(t[30]=e("span",{class:"text-gray-500"},"Reference",-1)),e("span",Je,u(((l=j.value)==null?void 0:l.reference)||"TXN-XXXXXXXX"),1)]),e("div",Ke,[t[31]||(t[31]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",Qe,u(s(V)(s(a).amount*100,((r=x.value)==null?void 0:r.currency)||"USD")),1)]),e("div",We,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Recipient",-1)),e("span",Ze,u((_=y.value)==null?void 0:_.name),1)])])]),e("div",et,[n(s(p),{label:"New Transfer",icon:"pi pi-plus",outlined:"",onClick:K}),n(s($),{href:"/accounts"},{default:d(()=>[n(s(p),{label:"View Accounts",icon:"pi pi-wallet"})]),_:1})])])]}),_:1})):v("",!0)]),n(s(L),{visible:T.value,"onUpdate:visible":t[6]||(t[6]=l=>T.value=l),modal:"",header:"Enter Transaction PIN",style:{width:"480px"},closable:!f.value},{footer:d(()=>[n(s(p),{label:"Cancel",text:"",onClick:t[5]||(t[5]=l=>T.value=!1),disabled:f.value},null,8,["disabled"]),n(s(p),{label:"Verify",icon:"pi pi-check",loading:f.value,onClick:X},null,8,["loading"])]),default:d(()=>[e("div",tt,[t[36]||(t[36]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter your 6-digit transaction PIN to continue. ",-1)),n(le,{modelValue:s(a).pin,"onUpdate:modelValue":t[4]||(t[4]=l=>s(a).pin=l),length:6,masked:"",onComplete:X},null,8,["modelValue"])])]),_:1},8,["visible","closable"]),n(s(L),{visible:h.value,"onUpdate:visible":t[9]||(t[9]=l=>h.value=l),modal:"",header:"Email Verification",style:{width:"400px"},closable:!f.value},{footer:d(()=>[n(s(p),{label:"Cancel",text:"",onClick:t[8]||(t[8]=l=>{h.value=!1,i.value=1}),disabled:f.value},null,8,["disabled"]),n(s(p),{label:"Verify & Transfer",icon:"pi pi-send",loading:f.value,onClick:B},null,8,["loading"])]),default:d(()=>[e("div",st,[t[37]||(t[37]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter the 6-digit code sent to your registered email address. ",-1)),n(oe,{modelValue:s(a).otp,"onUpdate:modelValue":t[7]||(t[7]=l=>s(a).otp=l),length:6,onComplete:B,onResend:J},null,8,["modelValue"])])]),_:1},8,["visible","closable"])]),_:1})],64))}};export{wt as default};
