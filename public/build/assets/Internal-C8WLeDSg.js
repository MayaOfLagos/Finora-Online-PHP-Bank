import{k as W,f as Z,G as ee,j as g,c as k,d as r,u as s,p as te,w as d,a as e,s as $,i as S,g as A,b as x,o as m,F as L,r as se,n as C,t as u,e as D,q as N}from"./app-CvydF_v8.js";import{a as f}from"./index-BypMu-dR.js";import{s as F}from"./index-kGn3S0Oa.js";import{s as ae}from"./index-C0d_cuHV.js";import{s as re}from"./index-CYAgiUNe.js";import{s as ne}from"./index-v9A9dLjY.js";import{s as q}from"./index-DRuIyVKW.js";import{s as U}from"./index-Ctq8AaO8.js";import{s as Y}from"./index-6_hXCyBs.js";import{_ as le}from"./DashboardLayout-BzxfP-Lv.js";import{_ as oe}from"./PinInput-DYzG1XeI.js";import{O as ie}from"./OtpInput-DLodouPw.js";import{u as ue}from"./useCurrency-0zMdEeak.js";/* empty css            */import"./index-COyFtG5m.js";import"./index-xKB_zved.js";import"./index-CyYx-0Vc.js";import"./index-D1T-yJd0.js";import"./AppLogo-BRPeOsCN.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"max-w-2xl mx-auto"},ce={class:"max-w-2xl mx-auto"},me={class:"mb-4"},pe={class:"space-y-6"},fe={class:"space-y-3"},ve=["onClick"],ye={class:"flex items-center justify-between"},xe={class:"flex items-center gap-3"},be={class:"font-medium text-gray-900 dark:text-white"},ge={class:"text-sm text-gray-500 dark:text-gray-400"},_e={class:"text-right"},ke={key:0,class:"mt-2 text-red-500 block"},he={class:"flex gap-2"},we={key:0,class:"text-red-500"},Se={class:"flex items-center gap-3"},Ce={class:"font-semibold"},Ve={class:"text-sm opacity-80"},Te={class:"flex justify-between mt-1 text-xs text-gray-500"},Ae={key:0},Pe={key:0,class:"text-red-500"},je={class:"flex justify-end gap-3 pt-4"},Ie={class:"mb-4"},Ne={class:"space-y-6"},Fe={class:"p-4 space-y-4 rounded-lg bg-gray-50 dark:bg-gray-800"},Ue={class:"flex justify-between"},Oe={class:"font-medium text-gray-900 dark:text-white"},$e={class:"flex justify-between"},De={class:"font-medium text-gray-900 dark:text-white"},Ee={class:"flex justify-between"},Re={class:"text-xl font-bold text-gray-900 dark:text-white"},Xe={key:0,class:"flex justify-between"},Be={class:"font-medium text-gray-900 dark:text-white"},Me={class:"flex justify-between gap-3 pt-4"},Le={class:"mb-4"},qe={class:"py-8 text-center"},Ye={class:"mb-4"},ze={class:"py-8 text-center"},Ge={class:"p-4 mt-6 text-left rounded-lg bg-gray-50 dark:bg-gray-800"},He={class:"space-y-3"},Je={class:"flex justify-between"},Ke={class:"font-mono text-gray-900 dark:text-white"},Qe={class:"flex justify-between"},We={class:"font-bold text-gray-900 dark:text-white"},Ze={class:"flex justify-between"},et={class:"text-gray-900 dark:text-white"},tt={class:"flex justify-center gap-3 mt-6"},st={class:"space-y-4"},at={class:"space-y-4"},Ct={__name:"Internal",props:{accounts:{type:Array,default:()=>[]},beneficiaries:{type:Array,default:()=>[]},transferLimits:{type:Object,default:()=>({daily:5e4,perTransaction:1e4})},preselectedAccountId:{type:[String,Number],default:null},verificationConfig:{type:Object,default:()=>({requiresOtp:!0})}},setup(z){const _=z,p=W(),{formatCurrency:V}=ue(),a=Z({from_account_id:_.preselectedAccountId||null,to_account_number:"",amount:null,description:"",pin:"",otp:""}),i=g(0),T=g(!1),h=g(!1),O=g(!1),w=g(!1),b=g(null),v=g(!1),P=g(!1),j=g(null),I=[{label:"Details"},{label:"Confirm"},{label:"Verify"},{label:"Complete"}],y=D(()=>_.accounts.find(l=>l.id===a.from_account_id)),G=D(()=>{if(!a.amount||!y.value)return!1;const l=a.amount*100;return l>0&&l<=y.value.balance&&a.amount<=_.transferLimits.perTransaction}),E=D(()=>i.value===0?a.from_account_id&&w.value&&G.value:!0),H=async()=>{if(!(!a.to_account_number||a.to_account_number.length<10)){O.value=!0,w.value=!1,b.value=null;try{const t=await(await fetch(route("api.accounts.verify",{accountNumber:a.to_account_number}))).json();if(t.success){const n=_.accounts.find(c=>c.id===a.from_account_id);if(n&&n.account_number===a.to_account_number){p.add({severity:"error",summary:"Invalid Recipient",detail:"You cannot transfer to your own account",life:3e3});return}w.value=!0,b.value=t.recipient}else p.add({severity:"error",summary:"Recipient Not Found",detail:"No account found with this account number",life:3e3})}catch{p.add({severity:"error",summary:"Verification Failed",detail:"Unable to verify recipient. Please try again.",life:3e3})}finally{O.value=!1}}};ee(()=>a.to_account_number,()=>{w.value=!1,b.value=null});const R=()=>{i.value===0&&E.value?i.value=1:i.value===1&&(T.value=!0)},J=()=>{i.value>0&&i.value--},X=()=>{if(a.pin.length!==6){p.add({severity:"error",summary:"Invalid PIN",detail:"Please enter your 6-digit transaction PIN",life:3e3});return}T.value=!1,v.value=!0,_.verificationConfig.requiresOtp?N.post("/transfers/internal/request-otp",{pin:a.pin,from_account_id:a.from_account_id,amount:Math.round((a.amount||0)*100)},{preserveScroll:!0,onSuccess:l=>{var n,c;i.value=2,h.value=!0;const t=((c=(n=l==null?void 0:l.props)==null?void 0:n.flash)==null?void 0:c.success)||"A verification code has been sent to your email";p.add({severity:"success",summary:"OTP Sent",detail:t,life:5e3})},onError:l=>{p.add({severity:"error",summary:"Verification Failed",detail:l.pin||"Invalid PIN. Please try again.",life:3e3})},onFinish:()=>{v.value=!1}}):N.post(route("transfers.internal.process"),{from_account_id:a.from_account_id,to_account_number:a.to_account_number,amount:Math.round((a.amount||0)*100),description:a.description,pin:a.pin,otp:"skip_otp"},{preserveScroll:!0,onSuccess:l=>{P.value=!0,j.value=l.props.transfer,i.value=3,p.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:l=>{p.add({severity:"error",summary:"Transfer Failed",detail:l.pin||l.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{v.value=!1}})},B=()=>{if(a.otp.length!==6){p.add({severity:"error",summary:"Invalid OTP",detail:"Please enter the 6-digit verification code",life:3e3});return}v.value=!0,N.post(route("transfers.internal.process"),{from_account_id:a.from_account_id,to_account_number:a.to_account_number,amount:Math.round((a.amount||0)*100),description:a.description,pin:a.pin,otp:a.otp},{preserveScroll:!0,onSuccess:l=>{h.value=!1,P.value=!0,j.value=l.props.transfer,i.value=3,p.add({severity:"success",summary:"Transfer Successful",detail:"Your transfer has been completed",life:5e3})},onError:l=>{p.add({severity:"error",summary:"Transfer Failed",detail:l.otp||l.general||"Transfer could not be completed",life:5e3})},onFinish:()=>{v.value=!1}})},K=()=>{N.post(route("transfers.internal.request-otp"),{pin:a.pin,from_account_id:a.from_account_id,amount:a.amount},{preserveScroll:!0,onSuccess:l=>{var n,c;const t=((c=(n=l==null?void 0:l.props)==null?void 0:n.flash)==null?void 0:c.success)||"A new verification code has been sent";p.add({severity:"success",summary:"OTP Resent",detail:t,life:3e3})}})},Q=()=>{a.reset(),i.value=0,P.value=!1,j.value=null,w.value=!1,b.value=null};return(l,t)=>(m(),k(L,null,[r(s(te),{title:"Internal Transfer"}),r(le,{title:"Internal Transfer"},{default:d(()=>[e("div",de,[r(s($),{href:"/transfers",class:"inline-flex items-center gap-2 mb-6 text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:d(()=>[...t[10]||(t[10]=[e("i",{class:"pi pi-arrow-left"},null,-1),S(" Back to Transfers ",-1)])]),_:1}),t[11]||(t[11]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Internal Transfer "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Transfer funds instantly to another Finora Bank user ")],-1))]),e("div",ce,[i.value===0?(m(),A(s(F),{key:0},{title:d(()=>[e("div",me,[r(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])]),t[12]||(t[12]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-file-edit text-primary-500"}),S(" Transfer Details ")],-1))]),content:d(()=>{var n,c;return[e("div",pe,[e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-wallet text-primary-600"}),S(" Select Source Account "),e("span",{class:"text-red-500"},"*")])],-1)),e("div",fe,[(m(!0),k(L,null,se(_.accounts.filter(o=>o.is_active),o=>{var M;return m(),k("div",{key:o.id,onClick:rt=>s(a).from_account_id=o.id,class:C(["p-4 transition-all duration-300 ease-in-out border-2 rounded-lg cursor-pointer",[s(a).from_account_id===o.id?"border-green-500 bg-green-50 dark:bg-green-900/20 shadow-md shadow-green-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",ye,[e("div",xe,[e("div",{class:C(["flex items-center justify-center w-10 h-10 transition-all duration-300 rounded-full",[s(a).from_account_id===o.id?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-500"]])},[e("i",{class:C(["pi transition-all duration-300",[s(a).from_account_id===o.id?"pi-check":"pi-wallet"]])},null,2)],2),e("div",null,[e("p",be,u(((M=o.account_type)==null?void 0:M.name)||"Account"),1),e("p",ge," ****"+u(o.account_number.slice(-4))+" â€¢ "+u(o.currency||"USD"),1)])]),e("div",_e,[e("p",{class:C(["text-lg font-bold",[s(a).from_account_id===o.id?"text-green-600":"text-gray-900 dark:text-white"]])},u(s(V)(o.balance,o.currency)),3),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500"},"Available",-1))])])],10,ve)}),128))]),s(a).errors.from_account_id?(m(),k("small",ke,u(s(a).errors.from_account_id),1)):x("",!0)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[S(" Recipient Account Number "),e("span",{class:"text-red-500"},"*")],-1)),e("div",he,[r(s(re),{modelValue:s(a).to_account_number,"onUpdate:modelValue":t[0]||(t[0]=o=>s(a).to_account_number=o),placeholder:"Enter account number",class:C(["flex-1",{"p-invalid":s(a).errors.to_account_number}])},null,8,["modelValue","class"]),r(s(f),{label:"Verify",icon:"pi pi-check",loading:O.value,disabled:!s(a).to_account_number||s(a).to_account_number.length<10,onClick:H},null,8,["loading","disabled"])]),s(a).errors.to_account_number?(m(),k("small",we,u(s(a).errors.to_account_number),1)):x("",!0)]),w.value&&b.value?(m(),A(s(Y),{key:0,severity:"success",closable:!1},{default:d(()=>[e("div",Se,[t[16]||(t[16]=e("i",{class:"text-xl pi pi-user"},null,-1)),e("div",null,[e("p",Ce,u(b.value.name),1),e("p",Ve,u(b.value.account_type)+" Account",1)])])]),_:1})):x("",!0),e("div",null,[t[17]||(t[17]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[S(" Amount "),e("span",{class:"text-red-500"},"*")],-1)),r(s(ae),{modelValue:s(a).amount,"onUpdate:modelValue":t[1]||(t[1]=o=>s(a).amount=o),mode:"currency",currency:((n=y.value)==null?void 0:n.currency)||"USD",locale:"en-US",placeholder:"0.00",class:C(["w-full",{"p-invalid":s(a).errors.amount}]),min:1,max:_.transferLimits.perTransaction},null,8,["modelValue","currency","class","max"]),e("div",Te,[y.value?(m(),k("span",Ae," Available: "+u(s(V)(y.value.balance,y.value.currency)),1)):x("",!0),e("span",null," Limit: "+u(s(V)(_.transferLimits.perTransaction*100,((c=y.value)==null?void 0:c.currency)||"USD"))+"/transaction ",1)]),s(a).errors.amount?(m(),k("small",Pe,u(s(a).errors.amount),1)):x("",!0)]),e("div",null,[t[18]||(t[18]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"}," Description (Optional) ",-1)),r(s(ne),{modelValue:s(a).description,"onUpdate:modelValue":t[2]||(t[2]=o=>s(a).description=o),rows:"3",placeholder:"Add a note for this transfer",class:"w-full"},null,8,["modelValue"])]),e("div",je,[r(s($),{href:"/transfers"},{default:d(()=>[r(s(f),{label:"Cancel",outlined:""})]),_:1}),r(s(f),{label:"Continue",icon:"pi pi-arrow-right",iconPos:"right",disabled:!E.value,onClick:R},null,8,["disabled"])])])]}),_:1})):x("",!0),i.value===1?(m(),A(s(F),{key:1},{title:d(()=>[e("div",Ie,[r(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])]),t[19]||(t[19]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-eye text-primary-500"}),S(" Confirm Transfer ")],-1))]),content:d(()=>{var n,c,o;return[e("div",Ne,[t[26]||(t[26]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Confirm Transfer Details ",-1)),e("div",Fe,[e("div",Ue,[t[20]||(t[20]=e("span",{class:"text-gray-500"},"From",-1)),e("span",Oe," ****"+u((n=y.value)==null?void 0:n.account_number.slice(-4)),1)]),e("div",$e,[t[21]||(t[21]=e("span",{class:"text-gray-500"},"To",-1)),e("span",De,u((c=b.value)==null?void 0:c.name)+" (****"+u(s(a).to_account_number.slice(-4))+") ",1)]),e("div",Ee,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",Re,u(s(V)(s(a).amount*100,((o=y.value)==null?void 0:o.currency)||"USD")),1)]),s(a).description?(m(),k("div",Xe,[t[23]||(t[23]=e("span",{class:"text-gray-500"},"Description",-1)),e("span",Be,u(s(a).description),1)])):x("",!0),t[24]||(t[24]=e("div",{class:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700"},[e("span",{class:"text-gray-500"},"Fee"),e("span",{class:"font-medium text-green-600"},"Free")],-1))]),r(s(Y),{severity:"info",closable:!1},{default:d(()=>[...t[25]||(t[25]=[e("p",{class:"text-sm"}," By proceeding, you authorize this transfer. This action cannot be undone. ",-1)])]),_:1}),e("div",Me,[r(s(f),{label:"Back",icon:"pi pi-arrow-left",outlined:"",onClick:J}),r(s(f),{label:"Confirm & Enter PIN",icon:"pi pi-lock",onClick:R})])])]}),_:1})):x("",!0),i.value===2?(m(),A(s(F),{key:2},{title:d(()=>[e("div",Le,[r(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>[e("div",qe,[t[27]||(t[27]=e("i",{class:"mb-4 text-5xl text-indigo-600 pi pi-shield"},null,-1)),t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Verification in Progress ",-1)),t[29]||(t[29]=e("p",{class:"mt-2 text-gray-500"}," Please complete the verification to proceed with your transfer. ",-1)),r(s(f),{label:"Enter Verification Code",icon:"pi pi-key",class:"mt-4",onClick:t[3]||(t[3]=n=>h.value=!0)})])]),_:1})):x("",!0),i.value===3&&P.value?(m(),A(s(F),{key:3},{title:d(()=>[e("div",Ye,[r(s(U),{model:I,activeStep:i.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>{var n,c,o;return[e("div",ze,[t[33]||(t[33]=e("div",{class:"flex items-center justify-center w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30"},[e("i",{class:"text-4xl text-green-600 pi pi-check dark:text-green-400"})],-1)),t[34]||(t[34]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"}," Transfer Successful! ",-1)),t[35]||(t[35]=e("p",{class:"mt-2 text-gray-500"}," Your transfer has been completed successfully. ",-1)),e("div",Ge,[e("div",He,[e("div",Je,[t[30]||(t[30]=e("span",{class:"text-gray-500"},"Reference",-1)),e("span",Ke,u(((n=j.value)==null?void 0:n.reference)||"TXN-XXXXXXXX"),1)]),e("div",Qe,[t[31]||(t[31]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",We,u(s(V)(s(a).amount*100,((c=y.value)==null?void 0:c.currency)||"USD")),1)]),e("div",Ze,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Recipient",-1)),e("span",et,u((o=b.value)==null?void 0:o.name),1)])])]),e("div",tt,[r(s(f),{label:"New Transfer",icon:"pi pi-plus",outlined:"",onClick:Q}),r(s($),{href:"/accounts"},{default:d(()=>[r(s(f),{label:"View Accounts",icon:"pi pi-wallet"})]),_:1})])])]}),_:1})):x("",!0)]),r(s(q),{visible:T.value,"onUpdate:visible":t[6]||(t[6]=n=>T.value=n),modal:"",header:"Enter Transaction PIN",style:{width:"480px"},closable:!v.value},{footer:d(()=>[r(s(f),{label:"Cancel",text:"",onClick:t[5]||(t[5]=n=>T.value=!1),disabled:v.value},null,8,["disabled"]),r(s(f),{label:"Verify",icon:"pi pi-check",loading:v.value,onClick:X},null,8,["loading"])]),default:d(()=>[e("div",st,[t[36]||(t[36]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter your 6-digit transaction PIN to continue. ",-1)),r(oe,{modelValue:s(a).pin,"onUpdate:modelValue":t[4]||(t[4]=n=>s(a).pin=n),length:6,masked:"",onComplete:X},null,8,["modelValue"])])]),_:1},8,["visible","closable"]),r(s(q),{visible:h.value,"onUpdate:visible":t[9]||(t[9]=n=>h.value=n),modal:"",header:"Email Verification",style:{width:"400px"},closable:!v.value},{footer:d(()=>[r(s(f),{label:"Cancel",text:"",onClick:t[8]||(t[8]=n=>{h.value=!1,i.value=1}),disabled:v.value},null,8,["disabled"]),r(s(f),{label:"Verify & Transfer",icon:"pi pi-send",loading:v.value,onClick:B},null,8,["loading"])]),default:d(()=>[e("div",at,[t[37]||(t[37]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter the 6-digit code sent to your registered email address. ",-1)),r(ie,{modelValue:s(a).otp,"onUpdate:modelValue":t[7]||(t[7]=n=>s(a).otp=n),length:6,onComplete:B,onResend:K},null,8,["modelValue"])])]),_:1},8,["visible","closable"])]),_:1})],64))}};export{Ct as default};
