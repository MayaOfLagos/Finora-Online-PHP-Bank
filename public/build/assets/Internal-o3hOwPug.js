import{f as ne,A as le,j as h,s as oe,c as m,o as c,d as l,u as s,m as ie,w as d,a as e,q as E,i as C,h as P,b as x,F as R,r as J,n as w,t as i,e as X,p as F}from"./app-pKJNfMRl.js";import{u as ue}from"./useToast-Clsx83_F.js";import{a as y}from"./index-0Wu5cDGM.js";import{s as O}from"./index-OLDQvyIc.js";import{s as ce}from"./index-CtUoG6pH.js";import{s as de}from"./index-CfAZwmyf.js";import{s as pe}from"./index-BobMLkE4.js";import{s as K}from"./index-C_ADElv8.js";import{s as U}from"./index-BzrWXWTT.js";import{s as W}from"./index-KeYFm4k9.js";import{D as me}from"./DashboardLayout-DUkHFthn.js";import{_ as fe}from"./PinInput-C7WwRcoz.js";import{O as ve}from"./OtpInput-DkuPDh8j.js";import{u as xe}from"./useCurrency-0zMdEeak.js";/* empty css            */import"./index-C89qVnDF.js";import"./index-DPCvanh-.js";import"./index-CNg3KC2i.js";import"./AppLogo-BTsSFa4-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./LiveChatWidget-BXRvd797.js";import"./index-D9m-7Ja_.js";const ye={class:"max-w-2xl mx-auto"},ge={class:"max-w-2xl mx-auto"},be={class:"mb-4"},_e={class:"space-y-6"},ke={class:"space-y-3"},he=["onClick"],we={class:"flex items-center justify-between"},Se={class:"flex items-center gap-3"},Ce={class:"font-medium text-gray-900 dark:text-white"},Te={class:"text-sm text-gray-500 dark:text-gray-400"},Ve={class:"text-right"},je={key:0,class:"mt-2 text-red-500 block"},Ae={key:0},Pe={class:"grid grid-cols-1 gap-2 sm:grid-cols-2"},Ie=["onClick"],Ne={class:"flex items-center gap-3"},Be={key:0,class:"pi pi-star-fill text-yellow-400"},Fe={class:"flex-1 min-w-0"},Oe={class:"font-medium text-gray-900 truncate dark:text-white"},Ue={class:"text-xs text-gray-500 dark:text-gray-400"},$e={key:0,class:"pi pi-check-circle text-indigo-600"},De={class:"flex gap-2"},Ee={key:0,class:"text-red-500"},Re={class:"flex items-center gap-3"},Xe={class:"font-semibold"},Me={class:"text-sm opacity-80"},Le={class:"flex justify-between mt-1 text-xs text-gray-500"},qe={key:0},Ye={key:0,class:"text-red-500"},ze={class:"flex justify-end gap-3 pt-4"},Qe={class:"mb-4"},Ge={class:"space-y-6"},He={class:"p-4 space-y-4 rounded-lg bg-gray-50 dark:bg-gray-800"},Je={class:"flex justify-between"},Ke={class:"font-medium text-gray-900 dark:text-white"},We={class:"flex justify-between"},Ze={class:"font-medium text-gray-900 dark:text-white"},et={class:"flex justify-between"},tt={class:"text-xl font-bold text-gray-900 dark:text-white"},st={key:0,class:"flex justify-between"},rt={class:"font-medium text-gray-900 dark:text-white"},at={class:"flex justify-between gap-3 pt-4"},nt={class:"mb-4"},lt={class:"py-8 text-center"},ot={class:"mb-4"},it={class:"py-8 text-center"},ut={class:"p-4 mt-6 text-left rounded-lg bg-gray-50 dark:bg-gray-800"},ct={class:"space-y-3"},dt={class:"flex justify-between"},pt={class:"font-mono text-gray-900 dark:text-white"},mt={class:"flex justify-between"},ft={class:"font-bold text-gray-900 dark:text-white"},vt={class:"flex justify-between"},xt={class:"text-gray-900 dark:text-white"},yt={class:"flex justify-center gap-3 mt-6"},gt={class:"space-y-4"},bt={class:"space-y-4"},Lt={__name:"Internal",props:{accounts:{type:Array,default:()=>[]},beneficiaries:{type:Array,default:()=>[]},transferLimits:{type:Object,default:()=>({daily:5e4,perTransaction:1e4})},preselectedAccountId:{type:[String,Number],default:null},preselectedBeneficiary:{type:Object,default:null},verificationConfig:{type:Object,default:()=>({requiresOtp:!0})}},setup(Z){const f=Z,v=ue(),{formatCurrency:V}=xe(),r=ne({from_account_id:f.preselectedAccountId||null,to_account_number:"",amount:null,description:"",pin:"",otp:""}),u=h(0),j=h(!1),T=h(!1),$=h(!1),S=h(!1),b=h(null),g=h(!1),I=h(!1),N=h(null),_=h(null),B=[{label:"Details"},{label:"Confirm"},{label:"Verify"},{label:"Complete"}],k=X(()=>f.accounts.find(n=>n.id===r.from_account_id)),ee=X(()=>{if(!r.amount||!k.value)return!1;const n=r.amount*100;return n>0&&n<=k.value.balance&&r.amount<=f.transferLimits.perTransaction}),M=X(()=>u.value===0?r.from_account_id&&S.value&&ee.value:!0),te=async()=>{if(!(!r.to_account_number||r.to_account_number.length<10)){$.value=!0,S.value=!1,b.value=null;try{const t=await(await fetch(route("api.accounts.verify",{accountNumber:r.to_account_number}))).json();if(t.success){const o=f.accounts.find(p=>p.id===r.from_account_id);if(o&&o.account_number===r.to_account_number){v.error("You cannot transfer to your own account","Invalid Recipient");return}S.value=!0,b.value=t.recipient}else v.error("No account found with this account number","Recipient Not Found")}catch{v.error("Unable to verify recipient. Please try again.","Verification Failed")}finally{$.value=!1}}},L=n=>{_.value=n,r.to_account_number=n.account_number,S.value=!0,b.value={name:n.nickname||n.beneficiary_name,account_type:"Savings"},v.success(`Transferring to ${n.nickname||n.beneficiary_name}`,"Beneficiary Selected")};le(()=>r.to_account_number,n=>{_.value&&_.value.account_number!==n&&(_.value=null),_.value||(S.value=!1,b.value=null)});const q=()=>{u.value===0&&M.value?u.value=1:u.value===1&&(j.value=!0)},se=()=>{u.value>0&&u.value--},Y=()=>{if(r.pin.length!==6){v.error("Please enter your 6-digit transaction PIN","Invalid PIN");return}j.value=!1,g.value=!0,f.verificationConfig.requiresOtp?F.post("/transfers/internal/request-otp",{pin:r.pin,from_account_id:r.from_account_id,amount:Math.round((r.amount||0)*100)},{preserveScroll:!0,onSuccess:n=>{var o,p;u.value=2,T.value=!0;const t=((p=(o=n==null?void 0:n.props)==null?void 0:o.flash)==null?void 0:p.success)||"A verification code has been sent to your email";v.success(t,"OTP Sent")},onError:n=>{v.error(n.pin||"Invalid PIN. Please try again.","Verification Failed")},onFinish:()=>{g.value=!1}}):F.post(route("transfers.internal.process"),{from_account_id:r.from_account_id,to_account_number:r.to_account_number,amount:Math.round((r.amount||0)*100),description:r.description,pin:r.pin,otp:"skip_otp"},{preserveScroll:!0,onSuccess:n=>{I.value=!0,N.value=n.props.transfer,u.value=3,v.success("Your transfer has been completed","Transfer Successful")},onError:n=>{v.error(n.pin||n.general||"Transfer could not be completed","Transfer Failed")},onFinish:()=>{g.value=!1}})},z=()=>{if(r.otp.length!==6){v.error("Please enter the 6-digit verification code","Invalid OTP");return}g.value=!0,F.post(route("transfers.internal.process"),{from_account_id:r.from_account_id,to_account_number:r.to_account_number,amount:Math.round((r.amount||0)*100),description:r.description,pin:r.pin,otp:r.otp},{preserveScroll:!0,onSuccess:n=>{T.value=!1,I.value=!0,N.value=n.props.transfer,u.value=3,v.success("Your transfer has been completed","Transfer Successful")},onError:n=>{v.error(n.otp||n.general||"Transfer could not be completed","Transfer Failed")},onFinish:()=>{g.value=!1}})},re=()=>{F.post(route("transfers.internal.request-otp"),{pin:r.pin,from_account_id:r.from_account_id,amount:r.amount},{preserveScroll:!0,onSuccess:n=>{var o,p;const t=((p=(o=n==null?void 0:n.props)==null?void 0:o.flash)==null?void 0:p.success)||"A new verification code has been sent";v.success(t,"OTP Resent")}})},ae=()=>{r.reset(),u.value=0,I.value=!1,N.value=null,S.value=!1,b.value=null,_.value=null};return oe(()=>{f.preselectedBeneficiary&&L(f.preselectedBeneficiary)}),(n,t)=>(c(),m(R,null,[l(s(ie),{title:"Internal Transfer"}),l(me,{title:"Internal Transfer"},{default:d(()=>[e("div",ye,[l(s(E),{href:"/transfers",class:"inline-flex items-center gap-2 mb-6 text-sm text-gray-500 transition-colors hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},{default:d(()=>[...t[10]||(t[10]=[e("i",{class:"pi pi-arrow-left"},null,-1),C(" Back to Transfers ",-1)])]),_:1}),t[11]||(t[11]=e("div",{class:"mb-6"},[e("h1",{class:"text-2xl font-bold text-gray-900 dark:text-white"}," Internal Transfer "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Transfer funds instantly to another Finora Bank user ")],-1))]),e("div",ge,[u.value===0?(c(),P(s(O),{key:0},{title:d(()=>[e("div",be,[l(s(U),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])]),t[12]||(t[12]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-file-edit text-primary-500"}),C(" Transfer Details ")],-1))]),content:d(()=>{var o,p;return[e("div",_e,[e("div",null,[t[14]||(t[14]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-wallet text-primary-600"}),C(" Select Source Account "),e("span",{class:"text-red-500"},"*")])],-1)),e("div",ke,[(c(!0),m(R,null,J(f.accounts.filter(a=>a.is_active),a=>{var A;return c(),m("div",{key:a.id,onClick:D=>s(r).from_account_id=a.id,class:w(["p-4 transition-all duration-300 ease-in-out border-2 rounded-lg cursor-pointer",[s(r).from_account_id===a.id?"border-green-500 bg-green-50 dark:bg-green-900/20 shadow-md shadow-green-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"]])},[e("div",we,[e("div",Se,[e("div",{class:w(["flex items-center justify-center w-10 h-10 transition-all duration-300 rounded-full",[s(r).from_account_id===a.id?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-500"]])},[e("i",{class:w(["pi transition-all duration-300",[s(r).from_account_id===a.id?"pi-check":"pi-wallet"]])},null,2)],2),e("div",null,[e("p",Ce,i(((A=a.account_type)==null?void 0:A.name)||"Account"),1),e("p",Te," ****"+i(a.account_number.slice(-4))+" • "+i(a.currency||"USD"),1)])]),e("div",Ve,[e("p",{class:w(["text-lg font-bold",[s(r).from_account_id===a.id?"text-green-600":"text-gray-900 dark:text-white"]])},i(s(V)(a.balance,a.currency)),3),t[13]||(t[13]=e("p",{class:"text-xs text-gray-500"},"Available",-1))])])],10,he)}),128))]),s(r).errors.from_account_id?(c(),m("small",je,i(s(r).errors.from_account_id),1)):x("",!0)]),f.beneficiaries&&f.beneficiaries.length>0?(c(),m("div",Ae,[t[15]||(t[15]=e("label",{class:"block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300"},[e("div",{class:"flex items-center gap-2"},[e("i",{class:"pi pi-users text-primary-600"}),C(" Quick Select from Saved Beneficiaries ")])],-1)),e("div",Pe,[(c(!0),m(R,null,J(f.beneficiaries,a=>{var A,D,Q,G,H;return c(),m("div",{key:a.uuid,onClick:_t=>L(a),class:w(["p-3 transition-all border-2 rounded-lg cursor-pointer hover:shadow-md",[((A=_.value)==null?void 0:A.uuid)===a.uuid?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-gray-200 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600"]])},[e("div",Ne,[e("div",{class:w(["flex items-center justify-center w-10 h-10 rounded-full",[((D=_.value)==null?void 0:D.uuid)===a.uuid?"bg-indigo-500 text-white":"bg-gray-100 dark:bg-gray-700"]])},[a.is_favorite?(c(),m("i",Be)):(c(),m("i",{key:1,class:w(["pi pi-user",((Q=_.value)==null?void 0:Q.uuid)===a.uuid?"text-white":"text-gray-500"])},null,2))],2),e("div",Fe,[e("p",Oe,i(a.nickname||a.beneficiary_name),1),e("p",Ue," ****"+i((G=a.account_number)==null?void 0:G.slice(-4))+" • "+i(a.currency),1)]),((H=_.value)==null?void 0:H.uuid)===a.uuid?(c(),m("i",$e)):x("",!0)])],10,Ie)}),128))]),t[16]||(t[16]=e("div",{class:"flex items-center my-4"},[e("div",{class:"flex-1 border-t border-gray-200 dark:border-gray-700"}),e("span",{class:"px-4 text-sm text-gray-500 dark:text-gray-400"},"or enter manually"),e("div",{class:"flex-1 border-t border-gray-200 dark:border-gray-700"})],-1))])):x("",!0),e("div",null,[t[17]||(t[17]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[C(" Recipient Account Number "),e("span",{class:"text-red-500"},"*")],-1)),e("div",De,[l(s(de),{modelValue:s(r).to_account_number,"onUpdate:modelValue":t[0]||(t[0]=a=>s(r).to_account_number=a),placeholder:"Enter account number",class:w(["flex-1",{"p-invalid":s(r).errors.to_account_number}])},null,8,["modelValue","class"]),l(s(y),{label:"Verify",icon:"pi pi-check",loading:$.value,disabled:!s(r).to_account_number||s(r).to_account_number.length<10,onClick:te},null,8,["loading","disabled"])]),s(r).errors.to_account_number?(c(),m("small",Ee,i(s(r).errors.to_account_number),1)):x("",!0)]),S.value&&b.value?(c(),P(s(W),{key:1,severity:"success",closable:!1},{default:d(()=>[e("div",Re,[t[18]||(t[18]=e("i",{class:"text-xl pi pi-user"},null,-1)),e("div",null,[e("p",Xe,i(b.value.name),1),e("p",Me,i(b.value.account_type)+" Account",1)])])]),_:1})):x("",!0),e("div",null,[t[19]||(t[19]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},[C(" Amount "),e("span",{class:"text-red-500"},"*")],-1)),l(s(ce),{modelValue:s(r).amount,"onUpdate:modelValue":t[1]||(t[1]=a=>s(r).amount=a),mode:"currency",currency:((o=k.value)==null?void 0:o.currency)||"USD",locale:"en-US",placeholder:"0.00",class:w(["w-full",{"p-invalid":s(r).errors.amount}]),min:1,max:f.transferLimits.perTransaction},null,8,["modelValue","currency","class","max"]),e("div",Le,[k.value?(c(),m("span",qe," Available: "+i(s(V)(k.value.balance,k.value.currency)),1)):x("",!0),e("span",null," Limit: "+i(s(V)(f.transferLimits.perTransaction*100,((p=k.value)==null?void 0:p.currency)||"USD"))+"/transaction ",1)]),s(r).errors.amount?(c(),m("small",Ye,i(s(r).errors.amount),1)):x("",!0)]),e("div",null,[t[20]||(t[20]=e("label",{class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"}," Description (Optional) ",-1)),l(s(pe),{modelValue:s(r).description,"onUpdate:modelValue":t[2]||(t[2]=a=>s(r).description=a),rows:"3",placeholder:"Add a note for this transfer",class:"w-full"},null,8,["modelValue"])]),e("div",ze,[l(s(E),{href:"/transfers"},{default:d(()=>[l(s(y),{label:"Cancel",outlined:""})]),_:1}),l(s(y),{label:"Continue",icon:"pi pi-arrow-right",iconPos:"right",disabled:!M.value,onClick:q},null,8,["disabled"])])])]}),_:1})):x("",!0),u.value===1?(c(),P(s(O),{key:1},{title:d(()=>[e("div",Qe,[l(s(U),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])]),t[21]||(t[21]=e("div",{class:"flex items-center gap-2 text-lg"},[e("i",{class:"pi pi-eye text-primary-500"}),C(" Confirm Transfer ")],-1))]),content:d(()=>{var o,p,a;return[e("div",Ge,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Confirm Transfer Details ",-1)),e("div",He,[e("div",Je,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"From",-1)),e("span",Ke," ****"+i((o=k.value)==null?void 0:o.account_number.slice(-4)),1)]),e("div",We,[t[23]||(t[23]=e("span",{class:"text-gray-500"},"To",-1)),e("span",Ze,i((p=b.value)==null?void 0:p.name)+" (****"+i(s(r).to_account_number.slice(-4))+") ",1)]),e("div",et,[t[24]||(t[24]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",tt,i(s(V)(s(r).amount*100,((a=k.value)==null?void 0:a.currency)||"USD")),1)]),s(r).description?(c(),m("div",st,[t[25]||(t[25]=e("span",{class:"text-gray-500"},"Description",-1)),e("span",rt,i(s(r).description),1)])):x("",!0),t[26]||(t[26]=e("div",{class:"flex justify-between pt-4 border-t border-gray-200 dark:border-gray-700"},[e("span",{class:"text-gray-500"},"Fee"),e("span",{class:"font-medium text-green-600"},"Free")],-1))]),l(s(W),{severity:"info",closable:!1},{default:d(()=>[...t[27]||(t[27]=[e("p",{class:"text-sm"}," By proceeding, you authorize this transfer. This action cannot be undone. ",-1)])]),_:1}),e("div",at,[l(s(y),{label:"Back",icon:"pi pi-arrow-left",outlined:"",onClick:se}),l(s(y),{label:"Confirm & Enter PIN",icon:"pi pi-lock",onClick:q})])])]}),_:1})):x("",!0),u.value===2?(c(),P(s(O),{key:2},{title:d(()=>[e("div",nt,[l(s(U),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>[e("div",lt,[t[29]||(t[29]=e("i",{class:"mb-4 text-5xl text-indigo-600 pi pi-shield"},null,-1)),t[30]||(t[30]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Verification in Progress ",-1)),t[31]||(t[31]=e("p",{class:"mt-2 text-gray-500"}," Please complete the verification to proceed with your transfer. ",-1)),l(s(y),{label:"Enter Verification Code",icon:"pi pi-key",class:"mt-4",onClick:t[3]||(t[3]=o=>T.value=!0)})])]),_:1})):x("",!0),u.value===3&&I.value?(c(),P(s(O),{key:3},{title:d(()=>[e("div",ot,[l(s(U),{model:B,activeStep:u.value,readonly:!0},null,8,["activeStep"])])]),content:d(()=>{var o,p,a;return[e("div",it,[t[35]||(t[35]=e("div",{class:"flex items-center justify-center w-20 h-20 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900/30"},[e("i",{class:"text-4xl text-green-600 pi pi-check dark:text-green-400"})],-1)),t[36]||(t[36]=e("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"}," Transfer Successful! ",-1)),t[37]||(t[37]=e("p",{class:"mt-2 text-gray-500"}," Your transfer has been completed successfully. ",-1)),e("div",ut,[e("div",ct,[e("div",dt,[t[32]||(t[32]=e("span",{class:"text-gray-500"},"Reference",-1)),e("span",pt,i(((o=N.value)==null?void 0:o.reference)||"TXN-XXXXXXXX"),1)]),e("div",mt,[t[33]||(t[33]=e("span",{class:"text-gray-500"},"Amount",-1)),e("span",ft,i(s(V)(s(r).amount*100,((p=k.value)==null?void 0:p.currency)||"USD")),1)]),e("div",vt,[t[34]||(t[34]=e("span",{class:"text-gray-500"},"Recipient",-1)),e("span",xt,i((a=b.value)==null?void 0:a.name),1)])])]),e("div",yt,[l(s(y),{label:"New Transfer",icon:"pi pi-plus",outlined:"",onClick:ae}),l(s(E),{href:"/accounts"},{default:d(()=>[l(s(y),{label:"View Accounts",icon:"pi pi-wallet"})]),_:1})])])]}),_:1})):x("",!0)]),l(s(K),{visible:j.value,"onUpdate:visible":t[6]||(t[6]=o=>j.value=o),modal:"",header:"Enter Transaction PIN",style:{width:"480px"},closable:!g.value},{footer:d(()=>[l(s(y),{label:"Cancel",text:"",onClick:t[5]||(t[5]=o=>j.value=!1),disabled:g.value},null,8,["disabled"]),l(s(y),{label:"Verify",icon:"pi pi-check",loading:g.value,onClick:Y},null,8,["loading"])]),default:d(()=>[e("div",gt,[t[38]||(t[38]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter your 6-digit transaction PIN to continue. ",-1)),l(fe,{modelValue:s(r).pin,"onUpdate:modelValue":t[4]||(t[4]=o=>s(r).pin=o),length:6,masked:"",onComplete:Y},null,8,["modelValue"])])]),_:1},8,["visible","closable"]),l(s(K),{visible:T.value,"onUpdate:visible":t[9]||(t[9]=o=>T.value=o),modal:"",header:"Email Verification",style:{width:"400px"},closable:!g.value},{footer:d(()=>[l(s(y),{label:"Cancel",text:"",onClick:t[8]||(t[8]=o=>{T.value=!1,u.value=1}),disabled:g.value},null,8,["disabled"]),l(s(y),{label:"Verify & Transfer",icon:"pi pi-send",loading:g.value,onClick:z},null,8,["loading"])]),default:d(()=>[e("div",bt,[t[39]||(t[39]=e("p",{class:"text-sm text-gray-600 dark:text-gray-400"}," Enter the 6-digit code sent to your registered email address. ",-1)),l(ve,{modelValue:s(r).otp,"onUpdate:modelValue":t[7]||(t[7]=o=>s(r).otp=o),length:6,onComplete:z,onResend:re},null,8,["modelValue"])])]),_:1},8,["visible","closable"])]),_:1})],64))}};export{Lt as default};
