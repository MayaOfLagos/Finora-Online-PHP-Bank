import{j as l,y as T,E as V,D as K,c as p,b as P,g as z,a as o,t as B,v as H,n as L,o as y}from"./app-DHxMuEMK.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={key:0,class:"recaptcha-container"},F={key:0,class:"flex items-center justify-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 min-h-[78px]"},I={key:1,class:"p-4 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 rounded-lg border border-red-200 dark:border-red-800 text-sm"},$={class:"flex items-center gap-2"},j={key:1,class:"recaptcha-v3-badge"},q={__name:"ReCaptcha",props:{siteKey:{type:String,required:!0},version:{type:String,default:"v2",validator:t=>["v2","v3"].includes(t)},action:{type:String,default:"submit"},theme:{type:String,default:"light",validator:t=>["light","dark"].includes(t)},size:{type:String,default:"normal",validator:t=>["compact","normal"].includes(t)},disabled:{type:Boolean,default:!1}},emits:["verify","expire","error","ready"],setup(t,{expose:b,emit:C}){const r=t,a=C,f=l(null),d=l(null),s=l(""),g=l(!1),i=l(!0),c=l(null),u=`recaptcha_${Math.random().toString(36).substr(2,9)}`,_=()=>new Promise((e,n)=>{if(window.grecaptcha&&window.grecaptcha.render){e();return}const w=document.querySelector('script[src*="recaptcha"]');if(w){w.addEventListener("load",e),w.addEventListener("error",n);return}window[u]=()=>{e(),delete window[u]};let h="https://www.google.com/recaptcha/api.js";r.version==="v3"?h+=`?render=${r.siteKey}`:h+=`?onload=${u}&render=explicit`;const v=document.createElement("script");v.src=h,v.async=!0,v.defer=!0,v.onerror=n,document.head.appendChild(v)}),m=()=>{if(!(!f.value||d.value!==null))try{d.value=window.grecaptcha.render(f.value,{sitekey:r.siteKey,theme:r.theme,size:r.size,callback:S,"expired-callback":A,"error-callback":E}),g.value=!0,i.value=!1,a("ready")}catch(e){console.error("reCAPTCHA render error:",e),c.value="Failed to load security verification",i.value=!1,a("error",e)}},x=()=>{g.value=!0,i.value=!1,a("ready")},k=async()=>{if(r.version!=="v3"||!window.grecaptcha)return"";try{const e=await window.grecaptcha.execute(r.siteKey,{action:r.action});return s.value=e,a("verify",e),e}catch(e){return console.error("reCAPTCHA v3 execute error:",e),a("error",e),""}},S=e=>{s.value=e,a("verify",e)},A=()=>{s.value="",a("expire")},E=()=>{c.value="Verification failed",a("error",new Error("reCAPTCHA error"))};return b({reset:()=>{r.version==="v2"&&d.value!==null&&window.grecaptcha&&(window.grecaptcha.reset(d.value),s.value="")},getToken:async()=>r.version==="v3"?await k():s.value,executeV3:k,token:s,isReady:g}),T(async()=>{if(!r.siteKey){i.value=!1;return}try{await _(),window.grecaptcha&&window.grecaptcha.ready?window.grecaptcha.ready(()=>{r.version==="v2"?m():x()}):setTimeout(()=>{r.version==="v2"?m():x()},500)}catch(e){console.error("Failed to load reCAPTCHA:",e),c.value="Failed to load security verification",i.value=!1,a("error",e)}}),V(()=>{window[u]&&delete window[u]}),K(()=>r.theme,()=>{r.version==="v2"&&d.value}),(e,n)=>t.version==="v2"?(y(),p("div",D,[i.value?(y(),p("div",F,[...n[0]||(n[0]=[o("div",{class:"flex items-center gap-2 text-gray-500 dark:text-gray-400"},[o("i",{class:"pi pi-spin pi-spinner text-lg"}),o("span",{class:"text-sm"},"Loading security verification...")],-1)])])):c.value?(y(),p("div",I,[o("div",$,[n[1]||(n[1]=o("i",{class:"pi pi-exclamation-triangle"},null,-1)),o("span",null,B(c.value),1)])])):P("",!0),z(o("div",{ref_key:"recaptchaContainer",ref:f,class:L(["recaptcha-widget",{"opacity-50 pointer-events-none":t.disabled}])},null,2),[[H,!i.value&&!c.value]])])):(y(),p("div",j))}},J=R(q,[["__scopeId","data-v-068f0c75"]]);export{J as R};
