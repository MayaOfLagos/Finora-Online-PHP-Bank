import{k as M,f as P,y as U,h as u,w as y,a as t,d as i,u as a,t as l,b as f,o,j as $,c as m,F as Y,r as I,n as c,z as w,x as E,i as N,ap as K,q as V}from"./app-Bp0bW-AQ.js";import{D as O}from"./DashboardLayout-U9aJU3Hz.js";import{s as z}from"./index-Duk7T7lg.js";import{a as g}from"./index-BEWvB2AC.js";import{s as _}from"./index-8Vk2EjSA.js";import{s as x}from"./index-nQ70lrs8.js";import{s as B}from"./index-QoWayXzQ.js";import{s as q}from"./index-C1LOsbmw.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./index-QgwzefI6.js";import"./index-B6U5Ei8f.js";import"./index-BS2TJOjP.js";import"./index-BH1Xpirw.js";import"./index-D6Ic9qyi.js";import"./index-DEmiseXg.js";import"./AppLogo-B7pGhi7-.js";const R={class:"space-y-4"},G={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},J={class:"flex items-center gap-3"},Q={class:"text-xl font-bold text-gray-900 dark:text-white"},W={class:"flex flex-wrap items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1"},X={class:"font-mono"},Z={class:"flex items-center gap-2 pl-10 sm:pl-0"},tt={class:"text-xs font-medium text-gray-600 dark:text-gray-400"},et={class:"text-black dark:text-white"},st={key:0,class:"flex flex-col items-center justify-center h-full text-gray-400"},at={key:0,class:"border-t dark:border-gray-700 p-4 bg-white dark:bg-gray-800"},rt={class:"flex-1"},it={class:"flex flex-col justify-start"},lt={key:1,class:"border-t dark:border-gray-700 p-4 bg-gray-100 dark:bg-gray-800 text-center"},ot={class:"text-gray-500 dark:text-gray-400"},nt={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},dt={class:"font-mono font-semibold text-gray-900 dark:text-white"},ct={class:"font-medium text-gray-900 dark:text-white"},ut={class:"font-medium text-gray-900 dark:text-white"},yt={class:"font-medium text-gray-900 dark:text-white"},mt={key:0},gt={class:"font-medium text-gray-900 dark:text-white"},xt={class:"flex justify-end gap-2"},kt={__name:"Show",props:{ticket:Object,messages:Array},setup(s){const h=s,k=M(),v=$(null),p=$(!1),d=P({message:""}),F={open:"info",in_progress:"warning",waiting:"secondary",resolved:"success",closed:"secondary"},A={low:"success",medium:"info",high:"warning",urgent:"danger"},C=n=>F[n]||"info",T=n=>A[n]||"info",S=()=>{K(()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)})};U(()=>{S()});const b=()=>{if(!d.message.trim()){k.add({severity:"warn",summary:"Empty Message",detail:"Please type a message before sending.",life:3e3});return}d.post(route("support.reply",h.ticket.uuid),{preserveScroll:!0,onSuccess:()=>{d.reset(),S(),k.add({severity:"success",summary:"Message Sent",detail:"Your reply has been sent successfully.",life:3e3})},onError:n=>{k.add({severity:"error",summary:"Error",detail:Object.values(n)[0]||"Failed to send message.",life:5e3})}})},D=()=>{V.post(route("support.close",h.ticket.uuid),{},{onSuccess:()=>{p.value=!1,k.add({severity:"success",summary:"Ticket Closed",detail:"Your ticket has been closed.",life:3e3})},onError:()=>{k.add({severity:"error",summary:"Error",detail:"Failed to close ticket.",life:5e3})}})},j=()=>{V.visit(route("support.index"))},L=n=>n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?";return(n,e)=>(o(),u(O,{title:`Ticket #${s.ticket.ticket_number}`},{default:y(()=>[t("div",R,[t("div",G,[t("div",J,[i(a(g),{icon:"pi pi-arrow-left",text:"",rounded:"",onClick:j,class:"flex-shrink-0"}),t("div",null,[t("h1",Q,l(s.ticket.subject),1),t("div",W,[t("span",X,l(s.ticket.ticket_number),1),e[4]||(e[4]=t("span",null,"•",-1)),t("span",null,l(s.ticket.category),1),e[5]||(e[5]=t("span",null,"•",-1)),t("span",null,l(s.ticket.created_at),1)])])]),t("div",Z,[i(a(x),{value:s.ticket.status_label,severity:C(s.ticket.status)},null,8,["value","severity"]),i(a(x),{value:s.ticket.priority_label,severity:T(s.ticket.priority),class:"!bg-opacity-20"},null,8,["value","severity"]),s.ticket.can_reply&&s.ticket.status!=="closed"?(o(),u(a(g),{key:0,icon:"pi pi-times",label:"Close Ticket",severity:"secondary",outlined:"",size:"small",onClick:e[0]||(e[0]=r=>p.value=!0)})):f("",!0)])]),i(a(z),{class:"!p-0"},{content:y(()=>[t("div",{ref_key:"chatContainer",ref:v,class:"h-[500px] overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900/50"},[(o(!0),m(Y,null,I(s.messages,r=>(o(),m("div",{key:r.id,class:c(["flex",r.is_agent?"justify-start":"justify-end"])},[t("div",{class:c(["max-w-[80%] md:max-w-[70%]",r.is_agent?"order-2":"order-1"])},[t("div",{class:c(["flex items-center gap-2 mb-1",r.is_agent?"flex-row":"flex-row-reverse"])},[r.sender_avatar?(o(),u(a(B),{key:0,image:r.sender_avatar,shape:"circle",size:"small"},null,8,["image"])):(o(),u(a(B),{key:1,label:L(r.sender_name),shape:"circle",size:"small",class:c(r.is_agent?"bg-blue-500 text-white":"bg-primary text-white")},null,8,["label","class"])),t("span",tt,l(r.sender_name),1),r.is_agent?(o(),u(a(x),{key:2,value:"Support",severity:"info",class:"!text-xs !py-0 !px-1"})):f("",!0),r.type==="system"?(o(),u(a(x),{key:3,value:"System",severity:"secondary",class:"!text-xs !py-0 !px-1"})):f("",!0)],2),t("div",{class:c(["p-3 rounded-2xl shadow-sm",[r.is_agent?"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-tl-sm":"bg-primary text-white rounded-tr-sm",r.type==="system"&&"!bg-gray-200 dark:!bg-gray-700 !text-gray-600 dark:!text-gray-400 italic"]])},[t("p",et,l(r.message),1)],2),t("div",{class:c(["text-xs text-gray-400 dark:text-gray-500 mt-1 px-1",r.is_agent?"text-left":"text-right"])},l(r.created_at),3)],2)],2))),128)),!s.messages||s.messages.length===0?(o(),m("div",st,[...e[6]||(e[6]=[t("i",{class:"pi pi-comments text-5xl mb-3"},null,-1),t("p",null,"No messages yet",-1)])])):f("",!0)],512),s.ticket.can_reply?(o(),m("div",at,[t("form",{onSubmit:w(b,["prevent"]),class:"flex gap-3"},[t("div",rt,[i(a(_),{modelValue:a(d).message,"onUpdate:modelValue":e[1]||(e[1]=r=>a(d).message=r),placeholder:"Type your message...",rows:"2",class:c(["w-full resize-none",{"p-invalid":a(d).errors.message}]),onKeydown:[E(w(b,["ctrl"]),["enter"]),E(w(b,["meta"]),["enter"])]},null,8,["modelValue","class","onKeydown"]),e[7]||(e[7]=t("small",{class:"text-gray-400 dark:text-gray-500 text-xs mt-1 block"}," Press Ctrl+Enter to send ",-1))]),t("div",it,[i(a(g),{type:"submit",icon:"pi pi-send",label:"Send",loading:a(d).processing,disabled:!a(d).message.trim()},null,8,["loading","disabled"])])],32)])):(o(),m("div",lt,[t("p",ot,[e[8]||(e[8]=t("i",{class:"pi pi-lock mr-2"},null,-1)),N(" This ticket is "+l(s.ticket.status_label.toLowerCase())+". You cannot reply. ",1)]),i(a(g),{label:"Open New Ticket",text:"",class:"mt-2",onClick:j})]))]),_:1}),i(a(z),null,{title:y(()=>[...e[9]||(e[9]=[t("div",{class:"flex items-center gap-2 text-base"},[t("i",{class:"pi pi-info-circle text-primary"}),N(" Ticket Information ")],-1)])]),content:y(()=>[t("div",nt,[t("div",null,[e[10]||(e[10]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Ticket Number",-1)),t("p",dt,l(s.ticket.ticket_number),1)]),t("div",null,[e[11]||(e[11]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Status",-1)),i(a(x),{value:s.ticket.status_label,severity:C(s.ticket.status)},null,8,["value","severity"])]),t("div",null,[e[12]||(e[12]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Priority",-1)),i(a(x),{value:s.ticket.priority_label,severity:T(s.ticket.priority)},null,8,["value","severity"])]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Category",-1)),t("p",ct,l(s.ticket.category),1)]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Created",-1)),t("p",ut,l(s.ticket.created_at),1)]),t("div",null,[e[15]||(e[15]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Last Updated",-1)),t("p",yt,l(s.ticket.updated_at),1)]),s.ticket.assigned_agent?(o(),m("div",mt,[e[16]||(e[16]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Assigned Agent",-1)),t("p",gt,l(s.ticket.assigned_agent),1)])):f("",!0)])]),_:1})]),i(a(q),{visible:p.value,"onUpdate:visible":e[3]||(e[3]=r=>p.value=r),header:"Close Ticket",modal:!0,closable:!0,style:{width:"400px"}},{footer:y(()=>[t("div",xt,[i(a(g),{label:"Cancel",severity:"secondary",outlined:"",onClick:e[2]||(e[2]=r=>p.value=!1)}),i(a(g),{label:"Close Ticket",severity:"danger",onClick:D})])]),default:y(()=>[e[17]||(e[17]=t("div",{class:"flex items-center gap-3"},[t("i",{class:"pi pi-exclamation-triangle text-yellow-500 text-3xl"}),t("p",{class:"text-gray-700 dark:text-gray-300"}," Are you sure you want to close this ticket? You won't be able to reply to it anymore. ")],-1))]),_:1},8,["visible"])]),_:1},8,["title"]))}},At=H(kt,[["__scopeId","data-v-047be1b4"]]);export{At as default};
