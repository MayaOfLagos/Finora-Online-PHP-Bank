import{f as M,s as P,h as u,o,w as y,a as t,d as i,u as r,t as l,b as f,j as $,c as g,F as U,r as Y,n as c,y as w,x as E,i as N,ap as I,p as V}from"./app-B4IzlJiH.js";import{D as K}from"./DashboardLayout-C87mcen4.js";import{s as B}from"./index-CiR1w9gG.js";import{a as m}from"./index-CNbnBLPP.js";import{s as O}from"./index-C6Da2dHw.js";import{s as x}from"./index-B14K5NTQ.js";import{s as z}from"./index-DPkBELWk.js";import{s as _}from"./index-CCrayFw_.js";import{u as H}from"./useToast-DeduNY1I.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";/* empty css            */import"./index-Cw6_OrR2.js";import"./index-BTG8dc6t.js";import"./index-BJ5J71IX.js";import"./index-DUzKNN2I.js";import"./AppLogo-DJabikPM.js";import"./LiveChatWidget-CkEboDrz.js";import"./PagePreloader-B2BRt2VJ.js";const q={class:"space-y-4"},G={class:"flex flex-col sm:flex-row sm:items-center justify-between gap-4"},J={class:"flex items-center gap-3"},Q={class:"text-xl font-bold text-gray-900 dark:text-white"},W={class:"flex flex-wrap items-center gap-2 text-sm text-gray-500 dark:text-gray-400 mt-1"},X={class:"font-mono"},Z={class:"flex items-center gap-2 pl-10 sm:pl-0"},tt={class:"text-xs font-medium text-gray-600 dark:text-gray-400"},et={class:"text-black dark:text-white"},st={key:0,class:"flex flex-col items-center justify-center h-full text-gray-400"},rt={key:0,class:"border-t dark:border-gray-700 p-4 bg-white dark:bg-gray-800"},at={class:"flex-1"},it={class:"flex flex-col justify-start"},lt={key:1,class:"border-t dark:border-gray-700 p-4 bg-gray-100 dark:bg-gray-800 text-center"},ot={class:"text-gray-500 dark:text-gray-400"},nt={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm"},dt={class:"font-mono font-semibold text-gray-900 dark:text-white"},ct={class:"font-medium text-gray-900 dark:text-white"},ut={class:"font-medium text-gray-900 dark:text-white"},yt={class:"font-medium text-gray-900 dark:text-white"},gt={key:0},mt={class:"font-medium text-gray-900 dark:text-white"},xt={class:"flex justify-end gap-2"},pt={__name:"Show",props:{ticket:Object,messages:Array},setup(s){const h=s,p=H(),v=$(null),k=$(!1),d=M({message:""}),F={open:"info",in_progress:"warning",waiting:"secondary",resolved:"success",closed:"secondary"},A={low:"success",medium:"info",high:"warning",urgent:"danger"},C=n=>F[n]||"info",T=n=>A[n]||"info",S=()=>{I(()=>{v.value&&(v.value.scrollTop=v.value.scrollHeight)})};P(()=>{S()});const b=()=>{if(!d.message.trim()){p.warn("Please type a message before sending.","Empty Message");return}d.post(route("support.reply",h.ticket.uuid),{preserveScroll:!0,onSuccess:()=>{d.reset(),S(),p.success("Your reply has been sent successfully.","Message Sent")},onError:n=>{p.error(Object.values(n)[0]||"Failed to send message.","Error")}})},D=()=>{V.post(route("support.close",h.ticket.uuid),{},{onSuccess:()=>{k.value=!1,p.success("Your ticket has been closed.","Ticket Closed")},onError:()=>{p.error("Failed to close ticket.","Error")}})},j=()=>{V.visit(route("support.index"))},L=n=>n?n.split(" ").map(e=>e[0]).join("").toUpperCase().slice(0,2):"?";return(n,e)=>(o(),u(K,{title:`Ticket #${s.ticket.ticket_number}`},{default:y(()=>[t("div",q,[t("div",G,[t("div",J,[i(r(m),{icon:"pi pi-arrow-left",text:"",rounded:"",onClick:j,class:"flex-shrink-0"}),t("div",null,[t("h1",Q,l(s.ticket.subject),1),t("div",W,[t("span",X,l(s.ticket.ticket_number),1),e[4]||(e[4]=t("span",null,"•",-1)),t("span",null,l(s.ticket.category),1),e[5]||(e[5]=t("span",null,"•",-1)),t("span",null,l(s.ticket.created_at),1)])])]),t("div",Z,[i(r(x),{value:s.ticket.status_label,severity:C(s.ticket.status)},null,8,["value","severity"]),i(r(x),{value:s.ticket.priority_label,severity:T(s.ticket.priority),class:"!bg-opacity-20"},null,8,["value","severity"]),s.ticket.can_reply&&s.ticket.status!=="closed"?(o(),u(r(m),{key:0,icon:"pi pi-times",label:"Close Ticket",severity:"secondary",outlined:"",size:"small",onClick:e[0]||(e[0]=a=>k.value=!0)})):f("",!0)])]),i(r(B),{class:"!p-0"},{content:y(()=>[t("div",{ref_key:"chatContainer",ref:v,class:"h-[500px] overflow-y-auto p-4 space-y-4 bg-gray-50 dark:bg-gray-900/50"},[(o(!0),g(U,null,Y(s.messages,a=>(o(),g("div",{key:a.id,class:c(["flex",a.is_agent?"justify-start":"justify-end"])},[t("div",{class:c(["max-w-[80%] md:max-w-[70%]",a.is_agent?"order-2":"order-1"])},[t("div",{class:c(["flex items-center gap-2 mb-1",a.is_agent?"flex-row":"flex-row-reverse"])},[a.sender_avatar?(o(),u(r(z),{key:0,image:a.sender_avatar,shape:"circle",size:"small"},null,8,["image"])):(o(),u(r(z),{key:1,label:L(a.sender_name),shape:"circle",size:"small",class:c(a.is_agent?"bg-blue-500 text-white":"bg-primary text-white")},null,8,["label","class"])),t("span",tt,l(a.sender_name),1),a.is_agent?(o(),u(r(x),{key:2,value:"Support",severity:"info",class:"!text-xs !py-0 !px-1"})):f("",!0),a.type==="system"?(o(),u(r(x),{key:3,value:"System",severity:"secondary",class:"!text-xs !py-0 !px-1"})):f("",!0)],2),t("div",{class:c(["p-3 rounded-2xl shadow-sm",[a.is_agent?"bg-white dark:bg-gray-800 border dark:border-gray-700 rounded-tl-sm":"bg-primary text-white rounded-tr-sm",a.type==="system"&&"!bg-gray-200 dark:!bg-gray-700 !text-gray-600 dark:!text-gray-400 italic"]])},[t("p",et,l(a.message),1)],2),t("div",{class:c(["text-xs text-gray-400 dark:text-gray-500 mt-1 px-1",a.is_agent?"text-left":"text-right"])},l(a.created_at),3)],2)],2))),128)),!s.messages||s.messages.length===0?(o(),g("div",st,[...e[6]||(e[6]=[t("i",{class:"pi pi-comments text-5xl mb-3"},null,-1),t("p",null,"No messages yet",-1)])])):f("",!0)],512),s.ticket.can_reply?(o(),g("div",rt,[t("form",{onSubmit:w(b,["prevent"]),class:"flex gap-3"},[t("div",at,[i(r(O),{modelValue:r(d).message,"onUpdate:modelValue":e[1]||(e[1]=a=>r(d).message=a),placeholder:"Type your message...",rows:"2",class:c(["w-full resize-none",{"p-invalid":r(d).errors.message}]),onKeydown:[E(w(b,["ctrl"]),["enter"]),E(w(b,["meta"]),["enter"])]},null,8,["modelValue","class","onKeydown"]),e[7]||(e[7]=t("small",{class:"text-gray-400 dark:text-gray-500 text-xs mt-1 block"}," Press Ctrl+Enter to send ",-1))]),t("div",it,[i(r(m),{type:"submit",icon:"pi pi-send",label:"Send",loading:r(d).processing,disabled:!r(d).message.trim()},null,8,["loading","disabled"])])],32)])):(o(),g("div",lt,[t("p",ot,[e[8]||(e[8]=t("i",{class:"pi pi-lock mr-2"},null,-1)),N(" This ticket is "+l(s.ticket.status_label.toLowerCase())+". You cannot reply. ",1)]),i(r(m),{label:"Open New Ticket",text:"",class:"mt-2",onClick:j})]))]),_:1}),i(r(B),null,{title:y(()=>[...e[9]||(e[9]=[t("div",{class:"flex items-center gap-2 text-base"},[t("i",{class:"pi pi-info-circle text-primary"}),N(" Ticket Information ")],-1)])]),content:y(()=>[t("div",nt,[t("div",null,[e[10]||(e[10]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Ticket Number",-1)),t("p",dt,l(s.ticket.ticket_number),1)]),t("div",null,[e[11]||(e[11]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Status",-1)),i(r(x),{value:s.ticket.status_label,severity:C(s.ticket.status)},null,8,["value","severity"])]),t("div",null,[e[12]||(e[12]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Priority",-1)),i(r(x),{value:s.ticket.priority_label,severity:T(s.ticket.priority)},null,8,["value","severity"])]),t("div",null,[e[13]||(e[13]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Category",-1)),t("p",ct,l(s.ticket.category),1)]),t("div",null,[e[14]||(e[14]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Created",-1)),t("p",ut,l(s.ticket.created_at),1)]),t("div",null,[e[15]||(e[15]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Last Updated",-1)),t("p",yt,l(s.ticket.updated_at),1)]),s.ticket.assigned_agent?(o(),g("div",gt,[e[16]||(e[16]=t("p",{class:"text-gray-500 dark:text-gray-400"},"Assigned Agent",-1)),t("p",mt,l(s.ticket.assigned_agent),1)])):f("",!0)])]),_:1})]),i(r(_),{visible:k.value,"onUpdate:visible":e[3]||(e[3]=a=>k.value=a),header:"Close Ticket",modal:!0,closable:!0,style:{width:"400px"}},{footer:y(()=>[t("div",xt,[i(r(m),{label:"Cancel",severity:"secondary",outlined:"",onClick:e[2]||(e[2]=a=>k.value=!1)}),i(r(m),{label:"Close Ticket",severity:"danger",onClick:D})])]),default:y(()=>[e[17]||(e[17]=t("div",{class:"flex items-center gap-3"},[t("i",{class:"pi pi-exclamation-triangle text-yellow-500 text-3xl"}),t("p",{class:"text-gray-700 dark:text-gray-300"}," Are you sure you want to close this ticket? You won't be able to reply to it anymore. ")],-1))]),_:1},8,["visible"])]),_:1},8,["title"]))}},Dt=R(pt,[["__scopeId","data-v-49e5b075"]]);export{Dt as default};
